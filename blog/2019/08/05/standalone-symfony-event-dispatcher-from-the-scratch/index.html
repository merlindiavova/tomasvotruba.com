<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Standalone Symfony Event Dispatcher from the Scratch | Tomas Votruba</title>
<meta charset="utf-8">
<meta name="robots" content="index, follow">

<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">

<meta name="twitter:card" content="summary"/>
<meta name="twitter:creator" content="@votrubaT"/>

    <meta property="og:title" content="Standalone Symfony Event Dispatcher from the Scratch" />
    <meta property="og:url" content="https://tomasvotruba.com/blog/2019/08/05/standalone-symfony-event-dispatcher-from-the-scratch" />

            <meta property="og:image" content="https://tomasvotruba.com/assets/images/posts/2019/event_dispatcher_tweet.png" />
        <meta name="twitter:image" content="https://tomasvotruba.com/assets/images/posts/2019/event_dispatcher_tweet.png"/>
    
<link rel="alternate" type="application/rss+xml" title="Tomas Votruba Blog RSS" href="/rss.xml">


<link rel="stylesheet" rel="preload" as="style" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:700&amp;display=swap" />

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous" media="print" onload="this.media='all'">

<link href="/assets/css/style.css?1513073666" rel="stylesheet" type="text/css" />

                <meta name="description" property="og:description" content="Have you ever used Symfony Event Dispatcher? No?


This post is an introduction to Event Dispatcher, how to use it, and in the end, you&#039;ll be able to cover 90 % use cases you&#039;ll ever need.
" />
    </head>

    <body>
        <!-- post_id: 257 -->
        <div id="menu">
    <div class="container-fluid">
        <a href="/">Home</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/blog">Blog</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/book/the-power-of-automated-refactoring">Book</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/trainings">Trainings</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/contact">Contact</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/about-me">About Me</a>
        <span class="pl-2 pr-2">•</span>

        <a href="https://twitter.com/votrubaT" target="blank">Twitter</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/rss.xml" target="blank">RSS</a>
    </div>
</div>

        <div class="container-fluid post" id="content">
            <div class="text-center book-banner">
                <a href="https://leanpub.com/rector-the-power-of-automated-refactoring" target="blank" class="text-center">
                    <img src="/assets/images/banner-rector-book.png" class="mb-2 ml-auto mr-auto rounded " style="max-height: 5em" alt="">
                </a>
            </div>

            <h1>Standalone&nbsp;Symfony Event&nbsp;Dispatcher from&nbsp;the&nbsp;Scratch</h1>

            <div class="pull-right">
                <a href="https://github.com/tomasvotruba/tomasvotruba.com/edit/main/packages/blog/data/2019/2019-08-05-standalone-symfony-event-dispatcher-from-the-scratch.md">Found a typo? Edit me</a>
            </div>

            <time datetime="2019-08-Mon" class="text-muted">
                2019-08-05
            </time>

            
                            <div class="card border-success mt-4">
                    <div class="card-header text-white bg-success">
                        This post was updated at June 2020 with fresh know-how.
                        <br>
                        <strong>What is new?</strong>
                    </div>
                                            <div class="card-body pb-2">
                            <p>Updated with Symfony <a href="https://symfony.com/blog/new-in-symfony-4-3-simpler-event-dispatching">4.3 simple dispatching</a>, PHP 7.4 syntax and <a href="/blog/2020/05/25/the-bulletproof-event-naming-for-symfony-event-dispatcher/"><code>::class</code>-based event names</a>.</p>
                        </div>
                                    </div>

                <br>
            
            <div class="card card-bigger mb-5">
                <div class="card-body pb-2">
                    <p>Have you ever used Symfony Event Dispatcher? No?
<br>
<br>
This post is an introduction to Event Dispatcher, how to use it, and in the end, you'll be able to cover 90 % use cases you'll ever need.</p>
                </div>
            </div>

            <h2 id="What-is-the-Main-Purpose-of-Event-Dispatcher">What is the Main Purpose of Event Dispatcher?</h2>
<ul>
<li><strong>Extend an application</strong> in a certain place <strong>without putting any code right there</strong>.</li>
</ul>
<p><br></p>
<p>This way, you can extend 3rd party packages without rewriting them. And also allow other users to reach your code without even touching it.</p>
<p>Not sure how that looks? You will - at the end of this article.</p>
<h3 id="Event-Dispatcher">Event Dispatcher</h3>
<p><strong>This is the brain</strong>. It stores all subscribers and calls events when you need to.</p>
<h3 id="Event">Event</h3>
<p><strong>This is the name of a place</strong>. When something has happened in the application: <em>order is sent</em>, or <em>user is deleted</em>.</p>
<h3 id="Event-Subscriber">Event Subscriber</h3>
<p>This is <strong>the action that happens when</strong> we come to a specific event. When an order is sent (= Event), <em>send me a confirmation SMS</em> (= Event Subscriber). And <em>check that all the ordered products are on stock</em>.</p>
<p><strong>1 event can invoke MORE Event Subscribers</strong>.</p>
<h2 id="Create-First-Subscriber-in-3-Steps">Create First Subscriber in 3 Steps</h2>
<h3 id="1-Install-via-Composer">1. Install via Composer</h3>
<pre><code class="language-bash">composer require symfony/event-dispatcher</code></pre>
<h3 id="2-Create-Event-Dispatcher">2. Create Event Dispatcher</h3>
<pre><code class="language-php">// index.php
require_once __DIR__ . '/vendor/autoload.php';

// 1. create the Dispatcher
$eventDispatcher = new Symfony\Component\EventDispatcher\EventDispatcher;

// 2. some event happend, we dispatch it
$eventDispatcher-&gt;dispatch('youtube.newVideoPublished'); // oh: event is just a string</code></pre>
<p>Try it:</p>
<pre><code class="language-bash">php index.php</code></pre>
<p>Wow! Nothing happened...</p>
<p>That's ok because there is no Subscriber. So let's...</p>
<h3 id="3-Create-and-Register-Subscriber">3. Create and Register Subscriber</h3>
<pre><code class="language-php">use Symfony\Component\EventDispatcher\EventSubscriberInterface;

final class NotifyMeOnVideoPublishedEventSubscriber implements EventSubscriberInterface
{
    public bool $isUserNotified = false;

    public static function getSubscribedEvents(): array
    {
        // in format ['event name' =&gt; 'public function name that will be called']
        return ['youtube.newVideoPublished' =&gt; 'notifyUserAboutVideo'];
    }

    public function notifyUserAboutVideo()
    {
        // some logic to send notification
        $this-&gt;isUserNotified = true;
    }
}</code></pre>
<p>Let the Dispatcher know about the Subscriber.</p>
<pre><code class="language-php">$eventDispatcher = new Symfony\Component\EventDispatcher\EventDispatcher;

$eventSubscriber = new NotifyMeOnVideoPublishedEventSubscriber;
$eventDispatcher-&gt;addSubscriber($eventSubscriber);

// nothing happened, default value
var_dump($eventSubscriber-&gt;isUserNotified);
// false

// this calls our Subscriber
$eventDispatcher-&gt;dispatch('youtube.newVideoPublished');

// now it's changed
var_dump($eventSubscriber-&gt;isUserNotified);
// true</code></pre>
<p>Run the code again from command line:</p>
<pre><code class="language-bash">$ php index.php
int(0)
int(1)</code></pre>
<p>And now you understand EventDispatcher. At least in 90 % use cases.</p>
<hr />
<p>Still on? Let's get advanced.</p>
<p>What if we need to get the name of the Youtuber into the Subscriber?</p>
<h2 id="Event-Objects-to-the-Rescue">Event Objects to the Rescue!</h2>
<p>The Event objects are basically <a href="http://richardmiller.co.uk/2014/11/06/value-objects">Value Objects</a>. Pass a value in the constructor and get it with getter.</p>
<h3 id="1-Create-an-Event-Object">1. Create an Event Object</h3>
<pre><code class="language-php">use Symfony\Component\EventDispatcher\Event;

final class YoutuberNameEvent extends Event
{
    private string $youtuberName;

    public function __construct(string $youtuberName)
    {
        $this-&gt;youtuberName = $youtuberName;
    }

    public function getYoutuberName(): string
    {
        return $this-&gt;youtuberName;
    }
}</code></pre>
<h3 id="2-Use-Event-Object-in-Event-Subscriber">2. Use Event Object in Event Subscriber</h3>
<pre><code class="language-php">use Symfony\Component\EventDispatcher\EventSubscriberInterface;

final class NotifyMeOnVideoPublishedEventSubscriber implements EventSubscriberInterface
{
    public static function getSubscribedEvents(): array
    {
        return ['youtube.newVideoPublished' =&gt; 'notifyUserAboutVideo'];
    }

    // Event Object is passed as method argument
    public function notifyUserAboutVideo(YoutuberNameEvent $youtuberNameEvent)
    {
        var_dump($youtuberNameEvent-&gt;getYoutuberName());
    }
}</code></pre>
<h3 id="3-Create-an-Object-and-Dispatch-It">3. Create an Object and Dispatch It</h3>
<pre><code class="language-php">$youtuberNameEvent = new YoutuberNameEvent('Jirka Král');

$eventDispatcher-&gt;dispatch($youtuberNameEvent);</code></pre>
<p>And here is the result:</p>
<pre><code class="language-bash">$ php index.php
string('Jirka Král')</code></pre>
<h2 id="We-Are-1-Step-Further-Now">We Are 1 Step Further Now</h2>
<p>You can now:</p>
<ul>
<li>understand basic Event workflow</li>
<li>know what EventDispatcher and EventSubscriber are for</li>
<li>and know-how to pass parameters via the Event object</li>
</ul>
<h3 id="Where-to-go-next">Where to go next?</h3>
<p>Still hungry for knowledge? Check <a href="http://symfony.com/doc/current/components/event_dispatcher.html">Symfony documentation</a> then.</p>
<p>But remember: <strong>practice is the best teacher</strong>.</p>
<p><br><br></p>
<p>Happy coding!</p>

            <br>


            <div class="card mt-5 border-warning">
                <div class="card-body text-center mt-2">
                    <p>
                        Have you find this post useful? <strong>Do you want more?</strong>
                    </p>
                    <p>
                        Follow me on <a href="https://twitter.com/votrubaT">Twitter</a>, <a href="/rss.xml">RSS</a> or support me on <a href="https://github.com/sponsors/TomasVotruba">GitHub Sponsors</a>.
                    </p>
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-body text-white bg-success text-center">
                                            <a href="/blog/2020/06/15/how-to-create-monorepo-from-existing-repositories-in-7-steps" class="d-block">
                            <div>
                                Read next → <strong>How to create a Monorepo from Existing Repositories in 7 Steps</strong>
                            </div>
                        </a>
                                    </div>
            </div>

            <br>
            <br>

            <a name="comments"></a>
            <div id="disqus_thread"></div>

<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
    /*
    var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = 'https://itsworthsharing.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
        </div>

        <script id="dsq-count-scr" src="https://itsworthsharing.disqus.com/count.js" async defer></script>

        <link href="/assets/prism/prism.css" rel="stylesheet" type="text/css" />
        <script src="/assets/prism/prism.js"></script>

        <script>
    ga=function(){ ga.q.push(arguments) };
    ga.q=[];
    ga.l=+new Date;
    ga('create', 'UA-46082345-1', 'auto');
    ga('send','pageview');
</script>
<script src="https://www.google-analytics.com/analytics.js" async defer></script>

        <script type="text/javascript">
            // @see https://stackoverflow.com/a/30776817/1348344
            var date = new Date();
            // display every 2nd hour, not to spam users
            if (date.getHours() % 2 === 1) {
                document.querySelector('.book-banner').style.display = 'visible';
            } else {
                document.querySelector('.book-banner').style.display = 'none';
            }
        </script>
    </body>
</html>
