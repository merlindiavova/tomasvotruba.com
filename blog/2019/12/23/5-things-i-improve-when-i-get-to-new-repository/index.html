<!DOCTYPE html>
<html lang="en">
    <head>
        <title>5 Things I Improve when I Get  to new Repository | Tomas Votruba</title>
<meta charset="utf-8">
<meta name="robots" content="index, follow">

<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">

<meta name="twitter:card" content="summary"/>
<meta name="twitter:creator" content="@votrubaT"/>

<meta property="og:image" content="/assets/images/tomas_votruba.jpg"/>

<link rel="alternate" type="application/rss+xml" title="Tomas Votruba Blog RSS" href="/rss.xml">


<link rel="stylesheet" rel="preload" as="style" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:700&amp;display=swap" />

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous" media="print" onload="this.media='all'">

<link href="/assets/css/style.css?766670069" rel="stylesheet" type="text/css" />

                <meta property="og:title" content="5 Things I Improve when I Get  to new Repository" />
        <meta property="og:url" content="https://tomasvotruba.com/blog/2019/12/23/5-things-i-improve-when-i-get-to-new-repository" />
        <meta name="description" property="og:description" content="I started to write this post as follow up for [clean and sustainable code](/blog/2019/12/16/8-steps-you-can-make-before-huge-upgrade-to-make-it-faster-cheaper-and-more-stable/) post. In the middle of writing, I&#039;ve realized I have this approach to ever repository I meet.


Imagine it like a working desk. But not your usual stable place where you work every day. **Instead, you are assigned to a new desk of a former employee, who worked in the company for 5 years and as a bonus - it was the CTO**. For you, it&#039;s a mess.


What is the first thing we do? We&#039;ll **prepare it for hard work**.
" />

            </head>

    <body>
        <!-- post_id: 231 -->
        <div id="menu">
    <div class="container-fluid">
        <a href="/">Home</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/blog">Blog</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/book/the-power-of-automated-refactoring">Book</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/trainings">Trainings</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/contact">Contact</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/about-me">About Me</a>
        <span class="pl-2 pr-2">•</span>

        <a href="https://twitter.com/votrubaT" target="blank">Twitter</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/rss.xml" target="blank">RSS</a>
    </div>
</div>

        <div class="container-fluid post" id="content">
            <div class="text-center book-banner">
                <a href="https://leanpub.com/rector-the-power-of-automated-refactoring" target="blank" class="text-center">
                    <img src="/assets/images/banner-rector-book.png" class="mb-2 ml-auto mr-auto rounded " style="max-height: 5em" alt="">
                </a>
            </div>

            <h1>5&nbsp;Things&nbsp;I&nbsp;Improve when&nbsp;I&nbsp;Get&nbsp;&nbsp;to&nbsp;new&nbsp;Repository</h1>

            <div class="pull-right">
                <a href="https://github.com/tomasvotruba/tomasvotruba.com/edit/main/packages/blog/data/2019/2019-12-23-5-things-i-improve-when-i-get-to-new-repository.md">Found a typo? Edit me</a>
            </div>

            <time datetime="2019-12-Mon" class="text-muted">
                2019-12-23
            </time>

            
            
            <div class="card card-bigger mb-5">
                <div class="card-body pb-2">
                    <p>I started to write this post as follow up for <a href="/blog/2019/12/16/8-steps-you-can-make-before-huge-upgrade-to-make-it-faster-cheaper-and-more-stable/">clean and sustainable code</a> post. In the middle of writing, I've realized I have this approach to ever repository I meet.
<br>
<br>
Imagine it like a working desk. But not your usual stable place where you work every day. <strong>Instead, you are assigned to a new desk of a former employee, who worked in the company for 5 years and as a bonus - it was the CTO</strong>. For you, it's a mess.
<br>
<br>
What is the first thing we do? We'll <strong>prepare it for hard work</strong>.</p>
                </div>
            </div>

            <p>I get to 2-3 new projects/week and during the last couple of years I've noticed <strong>I repeat the same preparing process before work itself</strong>. It makes me much more effective and creates a very intuitive environment to work in.</p>
<h2 id="1-Set-1-Spacing-Rule">1. Set 1 Spacing Rule</h2>
<p>Without this file, every file has a different number of spaces, tabs, line-endings... and everything else we can't see.</p>
<p>Well, until you have errors like:</p>
<ul>
<li><em>YAML syntax error</em></li>
<li><em>Mix of tabs and spaces</em></li>
</ul>
<p>Or <em>creatively</em> structured code like:</p>
<pre><code class="language-php">&lt;?php

class SomeClass
{
public function someMethod()
{
}
}</code></pre>
<p>We don't need these problems, it's the computers' job.</p>
<p><strong>This takes 1 minute to set up and commit</strong>:</p>
<pre><code class="language-yaml"># .editorconfig
root = true

[*]
charset = utf-8
end_of_line = lf
insert_final_newline = true
trim_trailing_whitespace = true
indent_style = space
indent_size = 4</code></pre>
<p>✅</p>
<p><br></p>
<h2 id="2-Make-Sure-vendor-is-in-vendor">2. Make Sure vendor is in <code>vendor</code></h2>
<p>The easier miss-location, that works as default on some operation systems, is this:</p>
<pre><code class="language-json">{
    "config": {
        "vendor-dir": "Vendor"
    }
}</code></pre>
<p>It might be a great feeling to be creative for various reasons, but <strong>most PHP tools are not ready for this</strong>, e.g. PHPStan and Rector fail here.</p>
<p>Unless there is some supercritical issue, I always make it a standard way:</p>
<pre><code class="language-diff">-{
-    "config": {
-        "vendor-dir": "Vendor"
-    }
-}</code></pre>
<p>✅</p>
<p><br></p>
<h2 id="3-Move-Code-to-src">3. Move Code to <code>/src</code></h2>
<p>In times old so I can't remember, code was located randomly. Then PSR-0 came, then PSR-4. <a href="/blog/2019/12/16/8-steps-you-can-make-before-huge-upgrade-to-make-it-faster-cheaper-and-more-stable/#1-psr-4-standard">Many tools depend on PSR-4</a>, so another standard naturally came to my toolset.</p>
<blockquote class="blockquote text-center mt-5 mb-3">
    Keep source code in <code>/src</code>.
</blockquote>
<p>That means only source code needed for production, so:</p>
<ul>
<li><strong>no migrations</strong></li>
<li><strong>no fixtures</strong></li>
<li><strong>no test helpers</strong></li>
<li><strong>no coding standard utils</strong></li>
<li><strong>no Rector utils</strong></li>
<li><strong>no templates</strong></li>
<li><strong>no translations</strong></li>
<li><strong>no configs</strong></li>
<li><strong>no bin files</strong></li>
<li><strong>no helpers bash scripts</strong></li>
<li><strong>no cool git repository tricks</strong></li>
</ul>
<p>Once we rule in place know that every command, that works with PHP code will get only one argument: <code>src</code></p>
<pre><code class="language-bash">vendor/bin/ecs c src
vendor/bin/phpstan a src
vendor/bin/rector p src</code></pre>
<p>✅</p>
<p><br></p>
<h2 id="4-Directory-Name-Directory-Content">4. Directory Name = Directory Content</h2>
<p>Saying the one above, I apply the same for other content:</p>
<ul>
<li>binary files? → <code>bin</code></li>
<li>files used in continues integration? → <code>ci</code></li>
<li>configs? → <code>configs</code></li>
<li>templates? → <code>templates</code></li>
<li>translations? → <code>translations</code></li>
<li>database migrations? → <code>migration</code></li>
</ul>
<p>...and so on.</p>
<p>You may know it as:</p>
<blockquote class="blockquote text-center mt-5 mb-3">
    1 level architecture.
</blockquote>
<p>It's very intuitive to use, based on UX, DX and well... <strong>human brain. We tend to choose simpler solutions over complex ones</strong>. Often it leads to crappy application design.</p>
<p>I have a special case for Rector, coding standards, PHPStan rules, utils that helps in development, but aren't part of the project itself → <code>utils/&lt;project&gt;/src</code></p>
<p>✅</p>
<p><br></p>
<h2 id="5-fs-ps-pu-2-Chars-Shortcuts-for-Tools-that-Help-Me">5. <code>fs</code>, <code>ps</code>, <code>pu</code>... 2 Chars Shortcuts for Tools that Help Me</h2>
<pre><code class="language-bash">fs
ps
pu</code></pre>
<p>6 characters, even &quot;characters&quot; has 10 characters.</p>
<p>I can't imagine to code without them. What are they?</p>
<pre><code class="language-bash">vendor/bin/ecs check src tests --fix
vendor/bin/phpstan analyse src tests
vendor/bin/phpunit</code></pre>
<p>Well, now you know <a href="/blog/2019/11/25/the-single-best-skill-to-master-command-line/">I use aliases in my bash</a>. It's <strong>the ultimate <em>skill</em></strong>, because your brain gets much more space to think.</p>
<blockquote class="blockquote text-center mt-5 mb-5">
    "But every project has different directories.<br>
    Do you use some uber hack alias for every single project?"
</blockquote>
<p>That's right, in one project it is:</p>
<pre><code class="language-bash">vendor/bin/ecs check src tests --fix</code></pre>
<p>in another it is:</p>
<pre><code class="language-bash">vendor/bin/ecs check src packages tests --fix</code></pre>
<p>Well, this how my bash aliases look like:</p>
<pre><code class="language-bash">alias fs="composer fix-cs"
alias ps="composer phpstan"
alias pu="vendor/bin/phpunit"</code></pre>
<p><strong>I never change them</strong>. So where is the dynamic part?</p>
<p>Have you heard of <a href="https://blog.martinhujer.cz/have-you-tried-composer-scripts">composer scripts</a>?</p>
<p>In every project I came to, I set up dev dependencies and scripts first:</p>
<pre><code class="language-json">{
    "require-dev": {
        "symplify/easy-coding-standard": "^7.1",
        "phpstan/phpstan": "^0.12",
        "phpunit/phpunit": "^8.5"
    },
    "scripts": {
        "fix-cs": "vendor/bin/ecs check bin src tests --fix --ansi",
        "phpstan": "vendor/bin/phpstan analyse bin src tests --ansi --error-format symplify"
    }
}</code></pre>
<p>That way I can modify directories right in <code>composer.json</code>.</p>
<p>So <strong>when I do any change in the code</strong>:</p>
<ul>
<li>I open 3 terminals in PHPStorm console</li>
<li>I run 3 scripts in parallel = <strong>it's faster and I can focus better on 1 tool</strong></li>
<li>I know what came wrong and re-run only the broken part</li>
</ul>
<pre><code class="language-bash">fs
ps
pu</code></pre>
<p>As a side benefit, continuous integration is easier to set up and maintain:</p>
<pre><code class="language-yaml"># travis.yml
jobs:
    include:
        -
            stage: test
            name: ECS
            script:
                - composer check-cs

        -
            name: PHPStan
            script:
                - composer phpstan</code></pre>
<p>Is there one new directory <code>utils</code> to check? Just update <code>composer.json</code>:</p>
<pre><code class="language-diff"> {
     "require-dev": {
         "symplify/easy-coding-standard": "^7.1",
         "phpstan/phpstan": "^0.12",
         "phpunit/phpunit": "^8.5"
     },
     "scripts": {
-        "fix-cs": "vendor/bin/ecs check bin src tests --fix --ansi",
+        "fix-cs": "vendor/bin/ecs check bin src tests utils --fix --ansi",
-        "phpstan": "vendor/bin/phpstan analyse bin src tests --ansi --error-format symplify"
+        "phpstan": "vendor/bin/phpstan analyse bin src tests utils --ansi --error-format symplify"
    }
}</code></pre>
<p>This way I also see, <strong>what directories contain PHP code, that needs to be checked</strong>.</p>
<p>✅</p>
<p><br></p>
<blockquote class="blockquote text-center mt-5 mb-3">
    "If you want to go quickly, go alone.<br>
    If you want to go far, go together."
</blockquote>
<p><br></p>
<p>Happy Xmass Coding!</p>

            <br>


            <div class="card mt-5 border-warning">
                <div class="card-body text-center mt-2">
                    <p>
                        Have you find this post useful? <strong>Do you want more?</strong>
                    </p>
                    <p>
                        Follow me on <a href="https://twitter.com/votrubaT">Twitter</a>, <a href="/rss.xml">RSS</a> or support me on <a href="https://github.com/sponsors/TomasVotruba">GitHub Sponsors</a>.
                    </p>
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-body text-white bg-success text-center">
                                            <a href="/blog/2019/12/16/8-steps-you-can-make-before-huge-upgrade-to-make-it-faster-cheaper-and-more-stable" class="d-block">
                            <div>
                                Read next → <strong>8 Steps You Can Make Before Huge Upgrade to Make it Faster, Cheaper and More Stable</strong>
                            </div>
                        </a>
                                    </div>
            </div>

            <br>
            <br>

            <a name="comments"></a>
            <div id="disqus_thread"></div>

<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
    /*
    var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = 'https://itsworthsharing.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
        </div>

        <script id="dsq-count-scr" src="https://itsworthsharing.disqus.com/count.js" async defer></script>

        <link href="/assets/prism/prism.css" rel="stylesheet" type="text/css" />
        <script src="/assets/prism/prism.js"></script>

        <script>
    ga=function(){ ga.q.push(arguments) };
    ga.q=[];
    ga.l=+new Date;
    ga('create', 'UA-46082345-1', 'auto');
    ga('send','pageview');
</script>
<script src="https://www.google-analytics.com/analytics.js" async defer></script>

        <script type="text/javascript">
            // @see https://stackoverflow.com/a/30776817/1348344
            var date = new Date();
            // display every 2nd hour, not to spam users
            if (date.getHours() % 2 === 1) {
                document.querySelector('.book-banner').style.display = 'visible';
            } else {
                document.querySelector('.book-banner').style.display = 'none';
            }
        </script>
    </body>
</html>
