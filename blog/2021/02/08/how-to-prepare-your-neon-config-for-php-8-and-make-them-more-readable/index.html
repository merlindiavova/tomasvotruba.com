<!DOCTYPE html>
<html lang="en">
    <head>
        <title>How to Prepare your Neon Configs for PHP 8 and Make them More Readable | Tomas Votruba</title>
<meta charset="utf-8">
<meta name="robots" content="index, follow">

<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">

<meta name="twitter:card" content="summary"/>
<meta name="twitter:creator" content="@votrubaT"/>

<meta property="og:image" content="/assets/images/tomas_votruba.jpg"/>

<link rel="alternate" type="application/rss+xml" title="Tomas Votruba Blog RSS" href="/rss.xml">


<link rel="stylesheet" rel="preload" as="style" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:700&amp;display=swap" />

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous" media="print" onload="this.media='all'">

<link href="/assets/css/style.css?257819079" rel="stylesheet" type="text/css" />

                <meta property="og:title" content="How to Prepare your Neon Configs for PHP 8 and Make them More Readable" />
        <meta property="og:url" content="https://tomasvotruba.com/blog/2021/02/08/how-to-prepare-your-neon-config-for-php-8-and-make-them-more-readable" />
        <meta name="description" property="og:description" content="Good coding habits share a single treat. **They all are ~~resistant~~ fluid to future changes**. You don&#039;t have to change them when new packages or PHP is released. One of them is explicit code.


Do you use explicit NEON config syntax? Then upgrade to PHP 8, including deprecations, will not touch you.
Do you use magic syntax sugar cream? Today we&#039;ll look at how to make it right.
" />

            </head>

    <body>
        <!-- post_id: 301 -->
        <div id="menu">
    <div class="container-fluid">
        <a href="/">Home</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/blog">Blog</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/book/the-power-of-automated-refactoring">Book</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/trainings">Trainings</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/contact">Contact</a>
        <span class="pl-2 pr-2">•</span>

        <a href="https://twitter.com/votrubaT" target="blank">Twitter</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/rss.xml" target="blank">RSS</a>
    </div>
</div>

        <div class="container-fluid post" id="content">
            <div class="text-center book-banner">
                <a href="https://leanpub.com/rector-the-power-of-automated-refactoring" target="blank" class="text-center">
                    <img src="/assets/images/banner-rector-book.png" class="mb-2 ml-auto mr-auto rounded " style="max-height: 5em" alt="">
                </a>
            </div>

            <h1>How to Prepare your Neon Configs for PHP 8 and Make them More Readable</h1>

            <div class="pull-right">
                <a href="https://github.com/tomasvotruba/tomasvotruba.com/edit/main/packages/blog/data/2021/2021-02-08-how-to-prepare-your-neon-config-for-php-8-and-make-them-more-readable.md">Found a typo? Edit me</a>
            </div>

            <time datetime="2021-02-Mon" class="text-muted">
                2021-02-08
            </time>

            
            
            <div class="card card-bigger mb-5">
                <div class="card-body pb-2">
                    <p>Good coding habits share a single treat. <strong>They all are <del>resistant</del> fluid to future changes</strong>. You don't have to change them when new packages or PHP is released. One of them is explicit code.
<br>
<br>
Do you use explicit NEON config syntax? Then upgrade to PHP 8, including deprecations, will not touch you.
Do you use magic syntax sugar cream? Today we'll look at how to make it right.</p>
                </div>
            </div>

            <p>&quot;The OP neurons aligned in OD pattern suggest better space orientation empowered to MDS usage.&quot;</p>
<p>What is explicit text? A text that does not require Googling acronyms to understand it.</p>
<p><br></p>
<p>What is <strong>explicit code</strong>? A code that does not require documentation to understand.</p>
<h2 id="Have-you-Met-Magic">Have you Met... Magic?</h2>
<img src="https://imgs.xkcd.com/comics/tar.png" class="mt-4 mb-5">
<p>Could you guess what this line is? No Googling allowed! :)</p>
<pre><code class="language-yaml">services:
    - Aws\Client(['region'='western'])</code></pre>
<ul>
<li>A factory or a service?</li>
<li>Array of arguments or a single argument with an array?</li>
</ul>
<p><br></p>
<p>What about this one?</p>
<pre><code class="language-yaml">services:
    -
        factory: App\Some\Factory([KEY=%value%])</code></pre>
<ul>
<li>The array is an argument for the constructor of a factory?</li>
<li>Or parameters to the factory method?</li>
<li>The factory method... hm, probably <code>create()</code>?</li>
<li>Is the <code>KEY</code> an env variable?</li>
<li>Is <code>%value%</code> a parameter?</li>
</ul>
<p><br></p>
<p>Apart WTF readability and principle of highest surprise, there is a new problem since PHP 8.</p>
<h2 id="PHP-8-Named-Arguments-and-Optional-Parameter-Last">PHP 8 - Named Arguments and Optional Parameter Last</h2>
<p>This code used to be valid in PHP 7.4:</p>
<pre><code class="language-php">function foo($optional = null, $require)
{
}</code></pre>
<p>Since PHP 8, it is deprecated (see <a href="https://3v4l.org/PRo9Y">3v4l.org</a>).</p>
<p>The optional parameters <a href="https://php.watch/versions/8.0/deprecate-required-param-after-optional">must be <strong>after required</strong> parameters</a>, like this:</p>
<pre><code class="language-diff">-function foo($optional = null, $require)
+function foo($require, $optional = null)
 {
 }</code></pre>
<p>Don't worry about PHP code, Rector got <a href="https://github.com/rectorphp/rector/blob/master/docs/rector_rules_overview.md#optionalparametersafterrequiredrector">this case covered</a>. But what about all the NEON configs? If we <strong>change PHP code, the configs will break</strong> because they depend on the parameter order.</p>
<p>What about these &quot;named arguments&quot;? That might save us, but first, we have to untie this NEON spaghetti knot.</p>
<h2 id="1-Unwrap-Inlined-Services">1. Unwrap Inlined Services</h2>
<p>First, we need to untie these class + array single lines:</p>
<pre><code class="language-diff"> services:
-    - Aws\Client(['region'='western'])
+    -
+        class: Aws\Client
+        arguments:
+           - ['region'='western']</code></pre>
<h2 id="2-Use-Named-Arguments">2. Use Named Arguments</h2>
<p>Sometimes we have to look at the class constructor to be able to transform NEON correctly:</p>
<pre><code class="language-php">namespace Aws;

final class Client
{
    public function __construct(
        private array $configuration = [],
    ) {
        // ...
    }
}</code></pre>
<p>We see the argument is an <code>array</code> and is named <code>$configuration</code>. Let's use &quot;named argument&quot; in our NEON too:</p>
<pre><code class="language-diff"> services:
     -
         class: Aws\Client
         arguments:
-           - ['region'='western']
+           configuration: ['region'='western']</code></pre>
<p>Now, what happens if we add a new <strong>required argument</strong> to the constructor? But we can't add it after the optional argument in PHP 8. It will result in the argument order change!</p>
<pre><code class="language-diff"> namespace Aws;

 final class Client
 {
     public function __construct(
+        private SomeDependency $someDependency,
         private array $configuration = [],
     ) {
         // ...
     }
 }</code></pre>
<p>The code will still work thanks to named arguments ✅</p>
<h2 id="3-Unwrap-Inlined-Arrays">3. Unwrap Inlined Arrays</h2>
<p>Inlined arrays are confusing the same way the inlined services are. Let's get rid of them too while we're at it:</p>
<pre><code class="language-diff"> services:
     -
         class: Aws\Client
         arguments:
-            configuration: ['region'='western']
+            configuration:
+                region: 'western'</code></pre>
<p>There is also <code>{}</code> syntax for composed arrays. We can improve it too:</p>
<pre><code class="language-diff"> services:
     -
         class: App\SocialLogin
         arguments:
-            - { facebook: no, google: yes, twitter: no }
+            params:
+                facebook: no
+                google: yes
+                twitter: no</code></pre>
<h2 id="4-Remove-Implicit-Arguments">4. Remove Implicit Arguments</h2>
<p>Do you use a <code>...</code> syntax? That is a placeholder for &quot;complete autowired service here&quot;:</p>
<pre><code class="language-yaml">services:
    -
         class: App\Search
         arguments:
             - ...
             - ...
             - 'keys'</code></pre>
<p>With named arguments, this is no longer needed:</p>
<pre><code class="language-diff"> services:
     -
          class: App\Search
          arguments:
-             - ...
-             - ...
-             - 'keys'
+             type: 'keys'</code></pre>
<p>Also, the config became much more readable. Now we know that <code>'keys'</code> was used for a <code>type</code>.</p>
<p><br></p>
<p>Although named arguments were in NEON for a while, now our codebase is <strong>more consistent</strong>. The PHP with native named arguments and deprecated optional arguments first make the code base <strong>more robust</strong>.</p>
<p>The same rule that applies in NEON now applies in PHP. One <strong>less &quot;cool&quot; syntax sugar cream</strong> to learn and <strong>more space to focus on what matters to you</strong>.</p>
<p><br></p>
<p>Happy coding!</p>

            <br>


            <div class="card mt-5 border-warning">
                <div class="card-body text-center mt-2">
                    <p>
                        Have you find this post useful? <strong>Do you want more?</strong>
                    </p>
                    <p>
                        Follow me on <a href="https://twitter.com/votrubaT">Twitter</a>, <a href="/rss.xml">RSS</a> or support me on <a href="https://github.com/sponsors/TomasVotruba">GitHub Sponsors</a>.
                    </p>
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-body text-white bg-success text-center">
                                            <a href="/blog/2021/02/01/effective-debug-tricks-narrow-scoping" class="d-block">
                            <div>
                                Read next → <strong>Effective Debug Tricks: Narrow Scoping</strong>
                            </div>
                        </a>
                                    </div>
            </div>

            <br>
            <br>

            <a name="comments"></a>
            <div id="disqus_thread"></div>

<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
    /*
    var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = 'https://itsworthsharing.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
        </div>

        <script id="dsq-count-scr" src="https://itsworthsharing.disqus.com/count.js" async defer></script>

        <link href="/assets/prism/prism.css" rel="stylesheet" type="text/css" />
        <script src="/assets/prism/prism.js"></script>

        <script>
    ga=function(){ ga.q.push(arguments) };
    ga.q=[];
    ga.l=+new Date;
    ga('create', 'UA-46082345-1', 'auto');
    ga('send','pageview');
</script>
<script src="https://www.google-analytics.com/analytics.js" async defer></script>

        <script type="text/javascript">
            // @see https://stackoverflow.com/a/30776817/1348344
            var date = new Date();
            // display every 2nd hour, not to spam users
            if (date.getHours() % 2 === 1) {
                document.querySelector('.book-banner').style.display = 'visible';
            } else {
                document.querySelector('.book-banner').style.display = 'none';
            }
        </script>
    </body>
</html>
