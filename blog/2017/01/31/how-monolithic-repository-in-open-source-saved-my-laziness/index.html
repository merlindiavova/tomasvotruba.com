<!DOCTYPE html>
<html lang="en">
    <head>
        <title>How Monolithic Repository in Open Source saved my Laziness | Tomas Votruba</title>
<meta charset="utf-8">
<meta name="robots" content="index, follow">

<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">

<meta name="twitter:card" content="summary"/>
<meta name="twitter:creator" content="@votrubaT"/>

    <meta property="og:title" content="How Monolithic Repository in Open Source saved my Laziness" />
    <meta property="og:url" content="https://tomasvotruba.com/blog/2017/01/31/how-monolithic-repository-in-open-source-saved-my-laziness" />

            <meta property="og:image" content="/assets/images/tomas_votruba.jpg"/>
        <meta name="twitter:image" content="/assets/images/tomas_votruba.jpg"/>
    
<link rel="alternate" type="application/rss+xml" title="Tomas Votruba Blog RSS" href="/rss.xml">


<link rel="stylesheet" rel="preload" as="style" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:700&amp;display=swap" />

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous" media="print" onload="this.media='all'">

<link href="/assets/css/style.css?1865793293" rel="stylesheet" type="text/css" />

                <meta name="description" property="og:description" content="I&#039;ve started creating open-source about 6 years ago. Now I&#039;m maintaining over 20 repositories. I used classic standalone repositories, but with each new package I wanted to add, I realized, how much work it needs to keep everything up-to-date and consistent. So I didn&#039;t and got stuck.

Fortunately, I noticed talk from Fabien about monorepo and Symfony. I said to myself: &quot;I don&#039;t know a thing about it. Let&#039;s try it out. I can always return if it sucks.&quot;

I never did. Today I will show you why I see monorepo approach in open-source so awesome.
" />
    </head>

    <body>
        <!-- post_id: 25 -->
        <div id="menu">
    <div class="container-fluid">
        <a href="/">Home</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/blog">Blog</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/book/the-power-of-automated-refactoring">Book</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/trainings">Trainings</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/contact">Contact</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/about-me">About Me</a>
        <span class="pl-2 pr-2">•</span>

        <a href="https://twitter.com/votrubaT" target="blank">Twitter</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/rss.xml" target="blank">RSS</a>
    </div>
</div>

        <div class="container-fluid post" id="content">
            <div class="text-center book-banner">
                <a href="https://leanpub.com/rector-the-power-of-automated-refactoring" target="blank" class="text-center">
                    <img src="/assets/images/banner-rector-book.png" class="mb-2 ml-auto mr-auto rounded " style="max-height: 5em" alt="">
                </a>
            </div>

            <h1>How Monolithic Repository in Open Source saved my Laziness</h1>

            <div class="pull-right">
                <a href="https://github.com/tomasvotruba/tomasvotruba.com/edit/main/packages/blog/data/2017/2017-01-31-how-monolithic-repository-in-open-source-saved-my-laziness.md">Found a typo? Edit me</a>
            </div>

            <time datetime="2017-01-Tue" class="text-muted">
                2017-01-31
            </time>

            
            
            <div class="card card-bigger mb-5">
                <div class="card-body pb-2">
                    <p>I've started creating open-source about 6 years ago. Now I'm maintaining over 20 repositories. I used classic standalone repositories, but with each new package I wanted to add, I realized, how much work it needs to keep everything up-to-date and consistent. So I didn't and got stuck.
<br><br>
Fortunately, I noticed <a href="https://www.youtube.com/watch?v=4w3-f6Xhvu8">talk from Fabien</a> about <a href="http://danluu.com/monorepo/">monorepo</a> and Symfony. I said to myself: &quot;I don't know a thing about it. Let's try it out. I can always return if it sucks.&quot;
<br><br>
I never did. Today I will show you <strong>why I see monorepo approach in open-source so awesome</strong>.</p>
                </div>
            </div>

            <p>If you don't have 50 minutes to watch the talk (my case), here are <strong><a href="https://speakerdeck.com/fabpot/a-monorepo-vs-manyrepos">40 slides</a></strong> from it.</p>
<p>Fabien introduces a tool, that helps you with splits - <a href="https://github.com/splitsh/lite">splitsh</a>. Do you understand it? Me neither. Splitsh is fast yet complex tool to maintain Symfony and Blackfire ecosystem. <strong>All we need is one git command</strong>.</p>
<p>But we'll get to that later. First things first.</p>
<h3 id="What-is-Monorepo">What is Monorepo?</h3>
<p><strong>Monorepo</strong> (for monolithic repository) is single repository, which contains code for group of packages (framework, application...).</p>
<p>Not only Symfony, but also:</p>
<ul>
<li><a href="https://github.com/laravel/framework">Laravel</a></li>
<li><a href="https://github.com/Sylius/Sylius">Sylius</a></li>
<li><a href="https://github.com/elcodi/elcodi">Elcodi</a> - which is dead now</li>
</ul>
<p>Opposed to this is <strong>manyrepo</strong> approach (for many repositories), meaning every package is in his own repository.</p>
<p>It is used by:</p>
<ul>
<li><a href="https://github.com/nette">Nette</a></li>
<li><a href="https://github.com/doctrine">Doctrine</a></li>
<li><a href="https://github.com/thephpleague">PHPLeague</a></li>
</ul>
<p>and almost everybody else.</p>
<p>So how does this monorepo work?</p>
<h2 id="From-One-Heart-to-Many-Arteries">From One Heart to Many Arteries</h2>
<p>Imagine flow of a oxygenated blood from heart to arteries. All blood that was in heart, will drift to all arteries.</p>
<img src="/assets/images/posts/2017/monorepo/blood-vein.png" alt="Blod vein" class="img-thumbnail">
<p>From <strong>1 heart</strong> to <strong>many arteries</strong> in one direction. Same relation is between <strong>1 monolithic repository</strong> and <strong>many repositories</strong>.</p>
<p>This is related to commits and tagging:</p>
<ul>
<li><strong>Every commit</strong> that does changes is Symfony\Console code in monorepo, is also in Symfony\Console manyrepo.</li>
<li><strong>Every tag</strong> in monorepo, is also in all manyrepos.</li>
</ul>
<h2 id="What-Are-top-4-Advantages-of-Monorepo">What Are top 4 Advantages of Monorepo?</h2>
<h3 id="1-It-scales">1. It scales</h3>
<p>You have one repo to maintain.</p>
<ul>
<li>New package? Not a problem.</li>
<li>Changing name of method that is used by 10 other packages? Easier than ever.</li>
<li>Starting a framework? Ideal.</li>
</ul>
<p>That's the way Nette, Symfony and Laravel started and grew so much, even if only one person was behind majority of commits.</p>
<h3 id="2-Upgrade-Fast-Upgrade-Safe">2. Upgrade Fast, Upgrade Safe</h3>
<p>It's easy to make changes that affect all packages - bump to PHP 7.1, Symfony 3.2 or Nette 3.0 is a matter of minutes.
And I know it works on all packages. Before monorepo, I had to upgrade every package manually, which resulted in dissonance:
one package used Symfony\Console 3.2, but other only 2.8 and it got messy for no reason.</p>
<h3 id="3-Test-Both-on-Monorepo-and-Manyrepo-Level-With-Ease">3. Test Both on Monorepo and Manyrepo Level With Ease</h3>
<p>Another thing I love is testing both monorepo (all packages together) and manyrepo level. Once I spend 5 hours fixing a bug in Symfony\Process. It was difficult to find, because all tests were passing. Even for testing just the Symfony\Process directory made it pass. But when I copied only the Symfony\Process code to the standalone directory, it failed. Few hours later I found out, it's somehow related to having Symfony\Stopwatch package. Yea, WTF.</p>
<p><strong>That could be caught testing on monorepo level.</strong></p>
<p>On the other hand, monorepo testing is also important. When Nette was split from monorepo to manyrepo only, all tests were passing packages were standalone. But in combination some of them didn't.</p>
<p>This is not issue of the code itself, but of the testing architecture.</p>
<h3 id="4-The-Burnout-is-Much-More-Harder">4. The Burnout is Much More Harder</h3>
<p>When maintaining 15 own packages, <a href="https://github.com/Apigen">ApiGen</a> and co-maintaining few more repositories, I spent a lot of time by package management and not coding. It wasn't fun and I contributed less and less.</p>
<p>Many packages like <a href="https://github.com/doctrine">Doctrine</a> or <a href="https://github.com/Kdyby">Kdyby</a> are slowing down in evolution because of this.</p>
<p>Again, it's a matter of project architecture rather than the code or maintainers.</p>
<p>These are the best for me, but there are many more described in <a href="https://speakerdeck.com/fabpot/a-monorepo-vs-manyrepos">those slides</a> by Fabien.</p>
<h2 id="Example-How-it-s-done-in-Symplify">Example: How it's done in Symplify</h2>
<h3 id="Monorepo">Monorepo</h3>
<p><a href="https://github.com/symplify/symplify">symplify/symplify</a></p>
<pre><code class="language-bash">/packages
    /Symplify
        /DefaultAutowire
            /src
            /tests
            composer.json</code></pre>
<h3 id="Run-Git-Command">Run Git Command</h3>
<p>Inspired by <a href="https://github.com/laravel/framework/tree/17ee3fd536d1db54dd4ae117c5665b6d03761337/build">Laravel</a>, all we really need is one git command. To split:</p>
<pre><code class="language-bash">git subsplit init git@github.com:symplify/symplify.git
git subsplit publish --heads="master" packages/DefaultAutowire:git@github.com:Symplify/DefaultAutowire.git
rm -rf .subsplit/</code></pre>
<p>It says: take code from <code>packages/DefaultAutowire</code> directory and put it to <code>git@github.com:Symplify/DefaultAutowire.git</code> repository.</p>
<h3 id="Manyrepo">Manyrepo</h3>
<p><a href="https://github.com/Symplify/DefaultAutowire">Symplify/DefaultAutowire</a></p>
<p>As a result, we have this:</p>
<pre><code class="language-bash">/src
/tests
composer.json</code></pre>
<p>That's it! Could it be simpler?</p>
<h3 id="Further-reading-Local-Packages">Further reading - Local Packages</h3>
<p>I recommend to read <a href="http://www.whitewashing.de/2015/04/11/monolithic_repositories_with_php_and_composer.html">Monolithic Repositories with PHP and Composer</a> by Benjamin Eberlei (Doctrine Core Maintainer). It's surpassed by composer <em>local packages</em>, but points remain the same. Don't worry, I will write about <em>local packages</em> in the near future.</p>
<p>If you like monorepo approach, but prefer own tagging per package, Martin Zlámal recently wrote about <a href="http://zlml.cz/vy-jeste-nemate-svuj-superprojekt">git submodule approach</a> (in Czech).</p>
<h3 id="How-do-you-like-this">How do you like this?</h3>
<p>This is my point of view.</p>
<p>Do you maintain lot of repositories? How do you make it fun to code and care for all of them?</p>
<p>Let me know in the comments. Thank you.</p>

            <br>


            <div class="card mt-5 border-warning">
                <div class="card-body text-center mt-2">
                    <p>
                        Have you find this post useful? <strong>Do you want more?</strong>
                    </p>
                    <p>
                        Follow me on <a href="https://twitter.com/votrubaT">Twitter</a>, <a href="/rss.xml">RSS</a> or support me on <a href="https://github.com/sponsors/TomasVotruba">GitHub Sponsors</a>.
                    </p>
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-body text-white bg-success text-center">
                                            <a href="/blog/2017/11/20/how-to-write-interesting-job-offers-for-programmers" class="d-block">
                            <div>
                                Read next → <strong>How to Write Interesting Jobs Offers for Programmers</strong>
                            </div>
                        </a>
                                    </div>
            </div>

            <br>
            <br>

            <a name="comments"></a>
            <div id="disqus_thread"></div>

<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
    /*
    var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = 'https://itsworthsharing.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
        </div>

        <script id="dsq-count-scr" src="https://itsworthsharing.disqus.com/count.js" async defer></script>

        <link href="/assets/prism/prism.css" rel="stylesheet" type="text/css" />
        <script src="/assets/prism/prism.js"></script>

        <script>
    ga=function(){ ga.q.push(arguments) };
    ga.q=[];
    ga.l=+new Date;
    ga('create', 'UA-46082345-1', 'auto');
    ga('send','pageview');
</script>
<script src="https://www.google-analytics.com/analytics.js" async defer></script>

        <script type="text/javascript">
            // @see https://stackoverflow.com/a/30776817/1348344
            var date = new Date();
            // display every 2nd hour, not to spam users
            if (date.getHours() % 2 === 1) {
                document.querySelector('.book-banner').style.display = 'visible';
            } else {
                document.querySelector('.book-banner').style.display = 'none';
            }
        </script>
    </body>
</html>
