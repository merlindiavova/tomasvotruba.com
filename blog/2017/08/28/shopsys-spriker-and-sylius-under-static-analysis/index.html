<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Shopsys, Spryker &amp; Sylius under Static Analysis | Tomas Votruba</title>
<meta charset="utf-8">
<meta name="robots" content="index, follow">

<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">

<meta name="twitter:card" content="summary"/>
<meta name="twitter:creator" content="@votrubaT"/>

<meta property="og:image" content="/assets/images/tomas_votruba.jpg"/>

<link rel="alternate" type="application/rss+xml" title="Tomas Votruba Blog RSS" href="/rss.xml">


<link rel="stylesheet" rel="preload" as="style" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:700&amp;display=swap" />

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous" media="print" onload="this.media='all'">

<link href="/assets/css/style.css?2051792479" rel="stylesheet" type="text/css" />

                <meta property="og:title" content="Shopsys, Spryker &amp; Sylius under Static Analysis" />
        <meta property="og:url" content="https://tomasvotruba.com/blog/2017/08/28/shopsys-spriker-and-sylius-under-static-analysis" />
        <meta name="description" property="og:description" content="When you&#039;re building a new web project based on open-source, you&#039;ll pick a package you know, have good experience with or try a new one that might be even better.

Lines of code, cyclomatic complexity, method count per class, length of method, number of interfaces relative to classes - these all can be just a superficial number or a quick measure how well is the project built.
" />

                    <meta property="og:image" content="https://tomasvotruba.com/assets/images/posts/2017/shopsys-static-anal/shopsys.png" />
            <meta name="twitter:card" content="summary_large_image"/>
            </head>

    <body>
        <!-- post_id: 52 -->
        <div id="menu">
    <div class="container-fluid">
        <a href="/">Home</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/blog">Blog</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/book/the-power-of-automated-refactoring">Book</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/trainings">Trainings</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/contact">Contact</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/about-me">About Me</a>
        <span class="pl-2 pr-2">•</span>

        <a href="https://twitter.com/votrubaT" target="blank">Twitter</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/rss.xml" target="blank">RSS</a>
    </div>
</div>

        <div class="container-fluid post" id="content">
            <div class="text-center book-banner">
                <a href="https://leanpub.com/rector-the-power-of-automated-refactoring" target="blank" class="text-center">
                    <img src="/assets/images/banner-rector-book.png" class="mb-2 ml-auto mr-auto rounded " style="max-height: 5em" alt="">
                </a>
            </div>

            <h1>Shopsys, Spryker & Sylius under Static Analysis</h1>

            <div class="pull-right">
                <a href="https://github.com/tomasvotruba/tomasvotruba.com/edit/main/packages/blog/data/2017/2017-08-28-shopsys-spriker-and-sylius-under-static-analysis.md">Found a typo? Edit me</a>
            </div>

            <time datetime="2017-08-Mon" class="text-muted">
                2017-08-28
            </time>

                            <div class="card border-danger mt-4">
                    <div class="card-header text-white bg-danger">
                        This post is deprecated since December 2018. Its knowledge is old and should not be used.
                        <br>
                        <strong>Why?</strong>
                    </div>
                    <div class="card-body pb-2">
                        <p>All 3 projects changed completely during last year, so <strong>these numbers are way outdated</strong>.</p>
                    </div>
                </div>

                <br>
            
            
            <div class="card card-bigger mb-5">
                <div class="card-body pb-2">
                    <p>When you're building a new web project based on open-source, you'll pick a package you know, have good experience with or try a new one that might be even better.</p>
<p>Lines of code, cyclomatic complexity, method count per class, length of method, number of interfaces relative to classes - these all can be just a superficial number or a <strong>quick measure how well is the project built</strong>.</p>
                </div>
            </div>

            <p><br></p>
<blockquote class="blockquote text-center">
 "Never trust any statistics that you didn't forge yourself."
 <footer class="blockquote-footer">Nazi propaganda about Winston Churchill</footer>
</blockquote>
<p><br></p>
<h2 id="Understanding-Statistics">Understanding Statistics</h2>
<p>I never trust posts with statistics without any data to re-run the results on or with such a complicated methodology that discourages me to try anything and rather trust the source.</p>
<p>Therefore, I wanted to make this post different. To have you in control, not the hype.</p>
<h3 id="Try-It-Yourself">Try It Yourself</h3>
<p>I've put all the used data and methodology in an open-source way in a <a href="https://github.com/TomasVotruba/shopsys-spryker-and-sylius-analysis">Github repository</a>, where <strong>you can install it and re-run on your own</strong>. You'll need to <a href="https://www.shopsys.com/#contact">ask for a access to open-beta of Shopsys Framework</a> - that's the one extra step. I will update both this post and repository after Shopsys Framework is open-source in late 2017.</p>
<h3 id="No-Black-and-White">No Black and White</h3>
<p>The aim of posts like these is usually just to put together arguments supporting author's opinion, so they are pretty useless for you if you disagree with the author.</p>
<p>To be clear, I work with Shopsys as an open-source consultant. I try to be as strict and honest with them as possible in order to make the product better. And this article is another example of if.</p>
<p>There is no winner and no loser, as you'll see. <strong>Let's dive into the numbers now</strong>.
From over 50 various metrics, I've picked 4 of them. After reading them, you'll have a bit better picture of the code quality of these projects.</p>
<p><br></p>
<p>We are going to analyze 3 e-commerce projects build on Symfony components:</p>
<p><br></p>
<div class="col-6 mb-3">
    <a href="https://www.shopsys.com/">
        <img src="/assets/images/posts/2017/shopsys-static-anal/shopsys.png">
    </a>
</div>
<div class="col-5">
    <a href="http://sylius.org/">
        <img src="/assets/images/posts/2017/shopsys-static-anal/sylius.png">
    </a>
</div>
<div class="col-5">
    <a href="https://spryker.com/">
        <img src="/assets/images/posts/2017/shopsys-static-anal/spryker.png">
    </a>
</div>
<h2 id="1-Lines-of-code">1. Lines of code</h2>
<p>Smaller projects are easier to understand, especially when you want to send a PR and need to understand their architecture.</p>
<h3 id="Lines-of-code">Lines of code</h3>
<ul>
<li>Shopsys: <strong>94 590</strong></li>
<li>Sylius: <strong>109 111</strong></li>
<li>Spryker: <strong>368 245</strong></li>
</ul>
<p><a href="https://github.com/TomasVotruba/shopsys-spryker-and-sylius-analysis/blob/89ff354b5298ba831c9124039f217dd0c5687e3d/src/Finder/PhpFilesFinder.php#L27-L31">Tests excluded</a>.</p>
<h2 id="2-Duplicated-Code">2. Duplicated Code</h2>
<p>Duplicated code can be a sign of coupled code and flaws in reusability.
<strong>Sylius has 0,24 % duplicated lines</strong>, Shopsys 0,67 % and lastly <strong>Spryker with 1,20 %</strong>.</p>
<h2 id="3-Cyclomatic-Complexity">3. Cyclomatic Complexity</h2>
<p>Cyclomatic Complexity is something like a train path with switches.</p>
<p><strong>The number of paths you can take in the method.</strong></p>
<p><strong>A.</strong> This is what we desire for in our code:</p>
<div>
    <img src="/assets/images/posts/2017/shopsys-static-anal/split-2.png" class="img-thumbnail">
</div>
<p><strong>B.</strong> And this what we often end-up with:</p>
<div>
    <img src="/assets/images/posts/2017/shopsys-static-anal/split-m.png" class="img-thumbnail">
</div>
<p>Which one would you pick if you'd be a programmer, in a method you never saw?</p>
<p>Cyclomatic complexity in PHP code would, <strong>for the example B</strong>, look like this:</p>
<pre><code class="language-php">final class ProductController extends Controller
{
    public function renderDetail(Request $request)
    {
        $id = $request-&gt;get('id'); # 1
        if ($id === null) { # 2
            throw new ProductIdMissingException('Id is required for product detail'.);
        }

        $product = $this-&gt;productRepository-&gt;get($id);
        if ($product === null) { # 3
            throw new ProductNotFoundException(sprintf('Product with id %d was not found.', $id);
        }

        if (! $product-&gt;isAvailable) { # 4
            $this-&gt;redirect('sold-out');
        }

        if ($this-&gt;isOnMobile()) { # 5
            foreach ($product-&gt;getImages() as $image) { # 6
                $image-&gt;resizeToMobile();
            }
        }

        $this-&gt;render('detail', [
            'product' =&gt; $product;
        ]);
    }
}</code></pre>
<p>...<strong>6 in total</strong>.</p>
<p>And for <strong>the example A</strong> like this:</p>
<pre><code class="language-php">final class ProductController extends Controller
{
    public function renderDetail(Product $product)
    {
        $this-&gt;ensureIsAvailable($product); # 1
        $this-&gt;prepareForMobile($product);

        $this-&gt;render('detail', [
            'product' =&gt; $product;
        ]);
    }
}</code></pre>
<p>...with <strong>just 1</strong>.</p>
<p>This metric can give you a decent overview of hot spots that might need refactoring.
<strong>When looking at this score, the lower the number the better</strong>. This applies to areas as readability, maintainability and testability.</p>
<p><strong>Consider writing a unit test and having a function with a cyclomatic complexity of 12</strong>. This means that, <strong>if you want 100% code coverage</strong>, you need to test every of these 12 paths and end up in pretty messy tests.</p>
<p>The results are:</p>
<p><em>Shopsys</em></p>
<ul>
<li>Complexity / Class: <strong>2.89</strong></li>
<li>Complexity / Method: <strong>1.53</strong></li>
</ul>
<p><em>Sylius</em></p>
<ul>
<li>Complexity / Class: <strong>2.52</strong></li>
<li>Complexity / Method: <strong>1.52</strong></li>
</ul>
<p><em>Spryker</em></p>
<ul>
<li>Complexity / Class: <strong>2.46</strong></li>
<li>Complexity / Method: <strong>1.46</strong></li>
</ul>
<p><br></p>
<h3 id="Extreme-Is-Never-Good">Extreme Is Never Good</h3>
<p>However, having the <strong>cyclomatic complexity = 1 in combination with low co-location</strong> could lead to issues like <a href="https://news.ycombinator.com/item?id=13364649"><em>ehnto</em> describes</a>:</p>
<p><em>&quot;What you want is never nearby, and thanks to the Facade system used for service location it also isn't always clear which class is actually being used without digging through some configuration files...</em></p>
<p><em>This leaves you digging through dozens of tiny files, some barely longer than the class definition itself, just to find even high level logic. I normally learn frameworks by simply reading the code, but I can't help but feel fatigued when having to try and find where a line of logic actually lives in Laravel. It is almost always a journey.&quot;</em></p>
<p>You can <a href="https://medium.com/@taylorotwell/measuring-code-complexity-64356da605f9">read similar comparison of Code Complexity in Symfony and Laravel</a> by Taylor Otwell. <a href="https://blog.sonarsource.com/discussing-cyclomatic-complexity">Maintainer vs. contributor view on Cyclomatic Complexity</a> is briefly described on SonarCube.</p>
<h2 id="4-It-s-All-About-Methods">4. It's All About Methods</h2>
<p>Last metrics focuses on the most used parts of the code - methods. Even if a project is small, long and complex methods can make it very difficult to use. On the other hand: <strong>huge projects with lines of clean and narrow methods can be fun and easy to work with</strong>.</p>
<p>Let's look at the metrics of methods:</p>
<p><em>Shopsys</em></p>
<ul>
<li>Max. Method Length: <strong>261 lines</strong></li>
<li>Max. Method Cyclomatic Complexity: <strong>12</strong></li>
</ul>
<p><em>Sylius</em></p>
<ul>
<li>Max. Method Length: <strong>26 lines</strong></li>
<li>Max. Method Cyclomatic Complexity: <strong>22</strong></li>
</ul>
<p><em>Spryker</em></p>
<ul>
<li>Max. Method Length: <strong>117 lines</strong></li>
<li>Max. Method Cyclomatic Complexity: <strong>64</strong></li>
</ul>
<p><br></p>
<p>Finally, I have a question for you. Based just on these numbers and without personal preferences, <strong>which one of the three projects would you pick and why</strong>?</p>
<h2 id="Stay-Tuned">Stay Tuned!</h2>
<p>In the follow up post, we'll look at these projects under PHPStan and Easy Coding Standard with PSR2 rulesets.</p>
<p>Happy coding!</p>

            <br>


            <div class="card mt-5 border-warning">
                <div class="card-body text-center mt-2">
                    <p>
                        Have you find this post useful? <strong>Do you want more?</strong>
                    </p>
                    <p>
                        Follow me on <a href="https://twitter.com/votrubaT">Twitter</a>, <a href="/rss.xml">RSS</a> or support me on <a href="https://github.com/sponsors/TomasVotruba">GitHub Sponsors</a>.
                    </p>
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-body text-white bg-success text-center">
                                            <a href="/blog/2017/11/20/how-to-write-interesting-job-offers-for-programmers" class="d-block">
                            <div>
                                Read next → <strong>How to Write Interesting Jobs Offers for Programmers</strong>
                            </div>
                        </a>
                                    </div>
            </div>

            <br>
            <br>

            <a name="comments"></a>
            <div id="disqus_thread"></div>

<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
    /*
    var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = 'https://itsworthsharing.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
        </div>

        <script id="dsq-count-scr" src="https://itsworthsharing.disqus.com/count.js" async defer></script>

        <link href="/assets/prism/prism.css" rel="stylesheet" type="text/css" />
        <script src="/assets/prism/prism.js"></script>

        <script>
    ga=function(){ ga.q.push(arguments) };
    ga.q=[];
    ga.l=+new Date;
    ga('create', 'UA-46082345-1', 'auto');
    ga('send','pageview');
</script>
<script src="https://www.google-analytics.com/analytics.js" async defer></script>

        <script type="text/javascript">
            // @see https://stackoverflow.com/a/30776817/1348344
            var date = new Date();
            // display every 2nd hour, not to spam users
            if (date.getHours() % 2 === 1) {
                document.querySelector('.book-banner').style.display = 'visible';
            } else {
                document.querySelector('.book-banner').style.display = 'none';
            }
        </script>
    </body>
</html>
