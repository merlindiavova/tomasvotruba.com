<!DOCTYPE html>
<html lang="en">
    <head>
        <title>How to write Open-Source in PHP 3: Deprecating Code | Tomas Votruba</title>
<meta charset="utf-8">
<meta name="robots" content="index, follow">

<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">

<meta name="twitter:card" content="summary"/>
<meta name="twitter:creator" content="@votrubaT"/>

    <meta property="og:image" content="/assets/images/tomas_votruba.jpg"/>

    <meta name="twitter:image" content="/assets/images/tomas_votruba.jpg"/>

<link rel="alternate" type="application/rss+xml" title="Tomas Votruba Blog RSS" href="/rss.xml">


<link rel="stylesheet" rel="preload" as="style" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:700&amp;display=swap" />

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous" media="print" onload="this.media='all'">

<link href="/assets/css/style.css?2039603331" rel="stylesheet" type="text/css" />

                <meta name="description" property="og:description" content="Humans, world and PHP Frameworks constantly evolve - their code functionality changes. Class or method is renamed, method has 1 new argument or new class is decoupled.

In Symfony world you probably know about Backward Compatibility Promise.
It prevents from unexpected and frustrating BC breaks and helps users to upgrade gradually thanks to deprecation messages.

In this post I will show you how to work with deprecation messages.
" />
    </head>

    <body>
        <!-- post_id: 54 -->
        <div id="menu">
    <div class="container-fluid">
        <a href="/">Home</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/blog">Blog</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/book/the-power-of-automated-refactoring">Book</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/trainings">Trainings</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/contact">Contact</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/about-me">About Me</a>
        <span class="pl-2 pr-2">•</span>

        <a href="https://twitter.com/votrubaT" target="blank">Twitter</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/rss.xml" target="blank">RSS</a>
    </div>
</div>

        <div class="container-fluid post" id="content">
            <div class="text-center book-banner">
                <a href="https://leanpub.com/rector-the-power-of-automated-refactoring" target="blank" class="text-center">
                    <img src="/assets/images/banner-rector-book.png" class="mb-2 ml-auto mr-auto rounded " style="max-height: 5em" alt="">
                </a>
            </div>

            <h1>How to write Open-Source in PHP 3: Deprecating Code</h1>

            <div class="pull-right">
                <a href="https://github.com/tomasvotruba/tomasvotruba.com/edit/main/packages/blog/data/2017/2017-09-11-how-to-write-open-source-in-php-3-deprecating-code.md">Found a typo? Edit me</a>
            </div>

            <time datetime="2017-09-Mon" class="text-muted">
                2017-09-11
            </time>

            
            
            <div class="card card-bigger mb-5">
                <div class="card-body pb-2">
                    <p>Humans, world and PHP Frameworks constantly evolve - their code functionality changes. Class or method is renamed, method has 1 new argument or new class is decoupled.
<br><br>
In Symfony world you probably know about <a href="https://symfony.com/doc/current/contributing/code/bc.html">Backward Compatibility Promise</a>.
It <strong>prevents from unexpected and frustrating BC breaks</strong> and helps users to upgrade gradually thanks to deprecation messages.
<br><br>
In this post I will show you <strong>how to work with deprecation messages</strong>.</p>
                </div>
            </div>

            <p>This technique is quite rare to see (apart PHP frameworks). It's very simple to add to your open-source code workflow though - let me convince you.</p>
<h2 id="Why-Write-Deprecation-Messages">Why Write Deprecation Messages?</h2>
<h3 id="If-you-DON-T">If you DON'T</h3>
<ul>
<li>people will have to find deprecations themselves in the commits - <strong>from programmer to detective</strong></li>
<li>you'll <strong>find issues</strong> like &quot;autowire() method missing - what should I do?&quot; at your package on Github</li>
<li>you'll have to remember, when you upgrade some project using your package few months later</li>
</ul>
<h3 id="If-you-DO">If you DO</h3>
<ul>
<li>people will like you</li>
<li>you'll be able to do more BC breaks in your code, because people will know they're taken care off</li>
<li><strong>upgrade of your package will be much easier</strong></li>
<li><strong>machine-readable messages will allow automate upgrades</strong></li>
</ul>
<p>To explain last point a bit more: if you write your message in a way, that some parser would be able to understand it, <strong>it would be able to refactor other code accordingly</strong>.</p>
<ol>
<li>
<p>Read</p>
<pre><code class="language-bash">SomeClass::oldMethod =&gt; SomeClass::newMethod</code></pre>
</li>
<li>
<p>Run</p>
<pre><code class="language-bash">bin/refactor app src</code></pre>
</li>
<li>
<p>Enjoy new code!</p>
</li>
</ol>
<p>That was <a href="https://github.com/tomasvotruba/Rector">the future</a>, now back to the present.</p>
<h2 id="Today-s-topic-Changed-Method-Name">Today's topic: Changed Method Name</h2>
<p>Let's take real example from real code - a class from <a href="https://doc.nette.org/en/2.4/html-elements#toc-elements-content"><code>Nette\Utils</code> 2.4</a>.</p>
<p>What we need to know?</p>
<ul>
<li><strong>a method name has changed</strong></li>
<li>from &quot;add&quot; to &quot;addHtml&quot;</li>
<li>on <code>Nette\Utils\Html</code> object</li>
</ul>
<p><strong>Before</strong> this change you used:</p>
<pre><code class="language-php">$html = Html::el('div');
$html-&gt;add('&lt;strong&gt;I am brand new!&lt;/strong&gt;');</code></pre>
<p>And <strong>after</strong> this change you will use:</p>
<pre><code class="language-php">$html = Html::el('div');
$html-&gt;addHtml('&lt;strong&gt;I am brand new!&lt;/strong&gt;');</code></pre>
<p>This is the snippet from the <code>Nette\Util\Html</code> class we are interested in:</p>
<pre><code class="language-php">namespace Nette\Utils;

class Html
{
    public function add(...)
    {
        // ...
    }
}</code></pre>
<p>So how to inform all ends users about this?</p>
<p>You can choose from <strong>2 ways to write deprecations messages</strong>, based on your preference.</p>
<h3 id="1-A-at-deprecate-annotation">1. A <code>@deprecate</code> annotation</h3>
<pre><code class="language-php">namespace Nette\Utils;

class Html
{
    /**
     * @deprecated
     */
    public function add(...)
    {
        $this-&gt;addHtml(...);
    }

    public function addHtml(...)
    {
        // ...
    }
}</code></pre>
<p>This is the least you can do. But you could do better, right?</p>
<pre><code class="language-php">/**
 * @deprecated Method add() is deprecated.
 */
public function add(...)</code></pre>
<p>Should I delete all those methods calls in my code?</p>
<pre><code class="language-php">/**
 * @deprecated Method add() is deprecated, use addHtml() instead.
 */
public function add(...)</code></pre>
<p><strong>A-ha, that's better!</strong></p>
<p><br></p>
<p>I Have 1 Question for you: <strong>What happens when programmer runs <code>$html-&gt;add(...)</code> method now?</strong></p>
<p>...</p>
<p>Well, exactly... <strong>nothing</strong>. <strong>Annotations have no influence on code run</strong>, so it will work and programmer won't notice anything.</p>
<p><br></p>
<p>Luckily, there is option that <strong>will actually inform about the deprecation</strong>.</p>
<h3 id="2-A-trigger-error">2. A <code>trigger_error()</code></h3>
<p>A <a href="https://php.net/manual/en/function.trigger-error.php"><code>trigger_error()</code></a> is native PHP function, that can inform user about changes in the code.</p>
<p>With the 2nd argument is level of these messages - there is special constant <code>E_USER_DEPRECATED</code> destined for this case.</p>
<pre><code class="language-php">namespace Nette\Utils;

class Html
{
    public function add(...)
    {
        # we already know how to write useful mesagges
        trigger_error('Method add() is deprecated, use addHtml() instead.', E_USER_DEPRECATED);

        $this-&gt;addHtml(...);
    })

    public function addHtml(...)
    {
        // ...
    }
}</code></pre>
<p>You can <a href="https://github.com/nette/utils/blob/f1584033b5af945b470533b466b81a789d532034/src/Utils/Html.php#L362">see it used in similar way</a> in the original code.</p>
<p><strong>What happens when programmer runs <code>$html-&gt;add(...)</code> method with this type of deprecation?</strong></p>
<p>2 things:</p>
<ul>
<li>The code will run</li>
<li><strong>The programmer will be informed</strong></li>
</ul>
<p>In case he or she is not ready for upgrade, it can be disabled in application <code>bootstrap</code> file:</p>
<pre><code class="language-php">error_reporting(~E_USER_DEPRECATED);</code></pre>
<p><a href="https://phpfashion.com/jak-spravne-updatovat-nette">Source</a> (Czech only)</p>
<p>I said...</p>
<p><em>It's very simple to add to your open-source code workflow...</em></p>
<p>...and this is it!</p>
<p>That was <a href="https://symfony.com/doc/current/contributing/code/bc.html">Symfony's Backward Compatibility Promise</a> in a nutshell.</p>
<p>Happy coding!</p>

            <br>


            <div class="card mt-5 border-warning">
                <div class="card-body text-center mt-2">
                    <p>
                        Have you find this post useful? <strong>Do you want more?</strong>
                    </p>
                    <p>
                        Follow me on <a href="https://twitter.com/votrubaT">Twitter</a>, <a href="/rss.xml">RSS</a> or support me on <a href="https://github.com/sponsors/TomasVotruba">GitHub Sponsors</a>.
                    </p>
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-body text-white bg-success text-center">
                                            <a href="/blog/2017/11/20/how-to-write-interesting-job-offers-for-programmers" class="d-block">
                            <div>
                                Read next → <strong>How to Write Interesting Jobs Offers for Programmers</strong>
                            </div>
                        </a>
                                    </div>
            </div>

            <br>
            <br>

            <a name="comments"></a>
            <div id="disqus_thread"></div>

<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
    /*
    var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = 'https://itsworthsharing.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
        </div>

        <script id="dsq-count-scr" src="https://itsworthsharing.disqus.com/count.js" async defer></script>

        <link href="/assets/prism/prism.css" rel="stylesheet" type="text/css" />
        <script src="/assets/prism/prism.js"></script>

        <script>
    ga=function(){ ga.q.push(arguments) };
    ga.q=[];
    ga.l=+new Date;
    ga('create', 'UA-46082345-1', 'auto');
    ga('send','pageview');
</script>
<script src="https://www.google-analytics.com/analytics.js" async defer></script>

        <script type="text/javascript">
            // @see https://stackoverflow.com/a/30776817/1348344
            var date = new Date();
            // display every 2nd hour, not to spam users
            if (date.getHours() % 2 === 1) {
                document.querySelector('.book-banner').style.display = 'visible';
            } else {
                document.querySelector('.book-banner').style.display = 'none';
            }
        </script>
    </body>
</html>
