<!DOCTYPE html>
<html lang="en">
    <head>
        <title>How to Convert Latte Templates to Twig in 27 Regular Expressions | Tomas Votruba</title>
<meta charset="utf-8">
<meta name="robots" content="index, follow">

<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">

<meta name="twitter:card" content="summary"/>
<meta name="twitter:creator" content="@votrubaT"/>

    <meta property="og:title" content="How to Convert Latte Templates to Twig in 27 Regular Expressions" />
    <meta property="og:url" content="https://tomasvotruba.com/blog/2018/07/05/how-to-convert-latte-templates-to-twig-in-27-regular-expressions" />

            <meta property="og:image" content="https://tomasvotruba.com/assets/images/posts/2018/latte-twig/diff.png" />
        <meta name="twitter:image" content="https://tomasvotruba.com/assets/images/posts/2018/latte-twig/diff.png"/>
    
<link rel="alternate" type="application/rss+xml" title="Tomas Votruba Blog RSS" href="/rss.xml">


<link rel="stylesheet" rel="preload" as="style" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:700&amp;display=swap" />

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous" media="print" onload="this.media='all'">

<link href="/assets/css/style.css?774657913" rel="stylesheet" type="text/css" />

                <meta name="description" property="og:description" content="Statie - a tool for generating static open-sourced website like this blog or [Pehapkari.cz](https://github.com/pehapkari/pehapkari.cz) - runs on YAML and Symfony DI Container. That way it&#039;s easy to understand by the PHP community worldwide.

But there are some pitfalls left. Like templates - being Latte the only one is a pity. Twig is often requested feature and one of the last big reasons not to use Statie.

Well, **it was**. Statie now supports [Twig](https://github.com/symplify/symplify/pull/892).

**Are you a Twig fan? As a side effect, I made 27 regular expression to handle 80 % of the Latte to Twig migration for you.**
" />
    </head>

    <body>
        <!-- post_id: 120 -->
        <div id="menu">
    <div class="container-fluid">
        <a href="/">Home</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/blog">Blog</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/book/the-power-of-automated-refactoring">Book</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/trainings">Trainings</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/contact">Contact</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/about-me">About Me</a>
        <span class="pl-2 pr-2">•</span>

        <a href="https://twitter.com/votrubaT" target="blank">Twitter</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/rss.xml" target="blank">RSS</a>
    </div>
</div>

        <div class="container-fluid post" id="content">
            <div class="text-center book-banner">
                <a href="https://leanpub.com/rector-the-power-of-automated-refactoring" target="blank" class="text-center">
                    <img src="/assets/images/banner-rector-book.png" class="mb-2 ml-auto mr-auto rounded " style="max-height: 5em" alt="">
                </a>
            </div>

            <h1>How to Convert Latte Templates to Twig in 27 Regular Expressions</h1>

            <div class="pull-right">
                <a href="https://github.com/tomasvotruba/tomasvotruba.com/edit/main/packages/blog/data/2018/2018-07-05-how-to-convert-latte-templates-to-twig-in-27-regular-expressions.md">Found a typo? Edit me</a>
            </div>

            <time datetime="2018-07-Thu" class="text-muted">
                2018-07-05
            </time>

            
                            <div class="card border-success mt-4">
                    <div class="card-header text-white bg-success">
                        This post was updated at March 2019 with fresh know-how.
                        <br>
                        <strong>What is new?</strong>
                    </div>
                                            <div class="card-body pb-2">
                            <p>Do you want to convert your code from Latte to TWIG?<br>
Go to <strong><a href="https://github.com/symplify/lattetotwigconverter">Latte To Twig Converter package</a> on Github</strong>.</p>
                        </div>
                                    </div>

                <br>
            
            <div class="card card-bigger mb-5">
                <div class="card-body pb-2">
                    <p>Statie - a tool for generating static open-sourced website like this blog or <a href="https://github.com/pehapkari/pehapkari.cz">Pehapkari.cz</a> - runs on YAML and Symfony DI Container. That way it's easy to understand by the PHP community worldwide.
<br><br>
But there are some pitfalls left. Like templates - being Latte the only one is a pity. Twig is often requested feature and one of the last big reasons not to use Statie.
<br><br>
Well, <strong>it was</strong>. Statie now supports <a href="https://github.com/symplify/symplify/pull/892">Twig</a>.
<br><br>
<strong>Are you a Twig fan? As a side effect, I made 27 regular expression to handle 80 % of the Latte to Twig migration for you.</strong></p>
                </div>
            </div>

            <img src="/assets/images/posts/2018/latte-twig/latte.png" class="mt-5 ml-5">
<img src="/assets/images/posts/2018/latte-twig/twig.jpg">
<p>This regex saga started as an experiment on this site. I tested the Twig support in Statie here. This web had ~20 files in Latte and I needed them to be in Twig, so I know the Twig support works with all the edge cases I use on daily basis.</p>
<p>After the 5th change of code from <code>{$value}</code> to <code>{{ value }}</code> I started to have a weird feeling of being a robot or <a href="/blog/2018/05/03/how-do-you-treat-your-own-first-ai/">a very slow AI</a>. So I stopped to think a bit...</p>
<blockquote class="blockquote text-center">
    "The question you should be asking isn't, "What do I want?" or "What are my goals?" but "What would excite me?"
    <footer class="blockquote-footer">Tim Ferriss</footer>
</blockquote>
<p>And what excites me? <strong>Investing 5 hours to automate 30-minutes manual work under 10 seconds, so no-one else will have to do that ever again.</strong></p>
<h2 id="Brother-from-Another-Mother">Brother from Another Mother</h2>
<p>The biggest difference between Latte, Twig, Smarty, Blade and all other templating engines is rather in the way they're written inside than in the syntax itself.</p>
<p>See Latte code:</p>
<pre><code class="language-html">{foreach $values as $key =&gt; $value}
    {$value-&gt;getName()}

    {if isset($value['position'])}
        {$value['position']|noescape}
    {else}
        {var $noPosition = true}
    {/if}
{/foreach}</code></pre>
<p>And see Twig code:</p>
<pre><code class="language-twig">{% for key, value in values %}
    {{ value.getName() }}

    {% if value.position is defined %}
        {{ value.position|raw }}
    {% else %}
        {% set noPosition = true %}
    {% endif %}
{% endfor %}</code></pre>
<p>And that's how 27 regular expressions solution was born step by step.</p>
<p><br></p>
<p>I'm not using <code>preg_replace</code>, but rather util method <a href="https://github.com/nette/utils/blob/8eda0c33f798f7ce491715e9dae8797f191e9b00/src/Utils/Strings.php#L475"><code>Nette\Utils\String::replace()</code></a> that handles compile-time errors, run-time errors and few more tricks in a fancy way. Do you want to use it too? Just run <code>composer update nette/utils</code>.</p>
<p><strong>Do you want to skip details and use it?</strong> Jump to <em><a href="#install-and-use-it">Install and Use It</a></em> section.</p>
<h3 id="1-Block-Define-Include">1. Block, Define, Include</h3>
<ul>
<li><a href="https://latte.nette.org/en/macros#toc-blocks">in Latte</a></li>
<li><a href="https://twig.symfony.com/doc/2.x/tags/block.html">in Twig</a></li>
</ul>
<pre><code class="language-php">use Nette\Utils\Strings;

// ...

// {block someBlock}...{/block} =&gt;
// {% block anotherBlock %}...{% endblock %}
$content = Strings::replace($content, '#{block (\w+)}(.*?){\/block}#s', '{% block $1 %}$2{% endblock %}');

// {include "_snippets/menu.latte"} =&gt;
// {% include "_snippets/menu.latte" %}
$content = Strings::replace($content, '#{include ([^}]+)}#', '{% include $1 %}');

// {define sth}...{/define} =&gt;
// {% block sth %}...{% endblock %}
$content = Strings::replace($content, '#{define (.*?)}(.*?){\/define}#s', '{% block $1 %}$2{% endblock %}');

// {% include ... %} =&gt;
// {{ block('...') }}
$content = Strings::replace($content, '#{% include \'?(\w+)\'? %}#', '{{ block(\'$1\') }}')</code></pre>
<p>The most useful expression here is <code>(.*?)</code>. <strong>It will capture everything until the next pattern</strong>. In this case it keeps everything between 2 tags.</p>
<p>Also, <strong>mind the <code>#s</code> modifier</strong>. <code>(.*?)</code> matches newlines as well thanks to that. You can read more about modifiers in <a href="http://php.net/manual/en/reference.pcre.pattern.modifiers.php">PHP Documentation</a></p>
<p>The last notable tip I learned is <code>\w</code>, that matches <code>[a-zA-Z0-9_]</code> characters - usually all you need for variable names.</p>
<h3 id="2-Capture-Set">2. Capture, Set</h3>
<ul>
<li><a href="https://latte.nette.org/en/macros#toc-variable-declaration">in</a> <a href="https://latte.nette.org/en/macros#toc-capturing-to-variables">Latte</a></li>
<li><a href="https://twig.symfony.com/doc/2.x/tags/set.html">in Twig</a></li>
</ul>
<pre><code class="language-php">use Nette\Utils\Strings;

// ...

// {var $var = $anotherVar} =&gt;
// {% set var = anotherVar %}
$content = Strings::replace($content, '#{var \$?(.*?) = \$?(.*?)}#s', '{% set $1 = $2 %}');

// {capture $var}...{/capture} =&gt;
// {% set var %}...{% endset %}
$content = Strings::replace($content, '#{capture \$(\w+)}(.*?){\/capture}#s', '{% set $1 %}$2{% endset %}');</code></pre>
<p>As Twig doesn't use <code>$var</code> but just <code>var</code> as variable name, we need to get rid of the dollar <code>$</code> sign.</p>
<p>That's what this expression does:</p>
<pre><code class="language-bash">\$?(.*?)</code></pre>
<p>It will capture anything, but if there is <code>$</code>, it will remove it.</p>
<h3 id="3-Comments">3. Comments</h3>
<ul>
<li><a href="https://latte.nette.org/en/macros">in Latte</a></li>
<li><a href="https://twig.symfony.com/doc/2.x/templates.html#comments">in Twig</a></li>
</ul>
<pre><code class="language-php">use Nette\Utils\Strings;

// ...

$content = Strings::replace($content, '#{\*(.*?)\*}#s', '{#$1#}');</code></pre>
<h3 id="4-Conditions-If-Ifset">4. Conditions, If, Ifset</h3>
<ul>
<li><a href="https://latte.nette.org/en/macros#toc-conditions">in Latte</a></li>
<li><a href="https://twig.symfony.com/doc/2.x/tags/if.html">in Twig</a></li>
</ul>
<pre><code class="language-php">use Nette\Utils\Strings;

// ...

// https://regex101.com/r/XKKoUh/1/
// {if isset($post['variable'])}...{/if} =&gt;
// {% if $post['variable'] is defined %}...{% endif %}
$content = Strings::replace(
    $content,
    '#{if isset\((.*?)\)}(.*?){\/if}#s',
    '{% if $1 is defined %}$2{% endif %}'
);

// {ifset $post}...{/ifset} =&gt;
// {% if $post is defined %}..{% endif %}
$content = Strings::replace($content, '#{ifset (.*?)}(.*?){\/ifset}#s', '{% if $1 is defined %}$2{% endif %}');

// {% if $post['deprecated'] =&gt;
// {% if $post.deprecated
// https://regex101.com/r/XKKoUh/2
$content = Strings::replace($content, '#{% (\w+) \$([A-Za-z]+)\[\'([\A-Za-z]+)\'\]#', '{% $1 $2.$3');

// {if "sth"}..{/if} =&gt;
// {% if "sth" %}..{% endif %}
// https://regex101.com/r/DrDSJf/1
$content = Strings::replace($content, '#{if (.*?)}(.*?){\/if}#s', '{% if $1 %}$2{% endif %}');

$content = Strings::replace($content, '#{else}#', '{% else %}');

$content = Strings::replace($content, '#{elseif (.*?)}#', '{% elseif $1 %}');</code></pre>
<p>Nothing fancy here, just another great use case for <code>(.*?)</code> group.</p>
<h3 id="5-Filters">5. Filters</h3>
<ul>
<li><a href="https://latte.nette.org/en/filters">in Latte</a></li>
<li><a href="https://twig.symfony.com/doc/2.x/filters/index.html">in Twig</a></li>
</ul>
<pre><code class="language-php">use Nette\Utils\Strings;

// ...

// {$post['updated_message']|noescape} =&gt;
// {{ post.updated_message|noescape }}
$content = Strings::replace($content, '#{\$([A-Za-z_-]+)\[\'([A-Za-z_-]+)\'\]\|([^}]+)}#', '{{ $1.$2|$3 }}');

// | noescape =&gt;
// | raw
$content = Strings::replace($content, '#\|(\s+)?noescape#', '|$1raw');

// {% if count($var) %} =&gt;
// {% if $var|length) %}
$content = Strings::replace($content, '#{% (.*?) count\(\$?(\w+)\)#', '{% $1 $2|length');</code></pre>
<p>No surprises here.</p>
<h3 id="6-Loops-While-For-Foreach">6. Loops, While, For, Foreach</h3>
<ul>
<li><a href="https://latte.nette.org/en/macros#toc-loops">in Latte</a></li>
<li><a href="https://twig.symfony.com/doc/2.x/tags/for.html">in Twig</a></li>
</ul>
<pre><code class="language-php">use Nette\Utils\Strings;

// ...

// {foreach $values as $key =&gt; $value}...{/foreach} =&gt;
// {% for key, value in values %}...{% endfor %}
$content = Strings::replace(
    $content,
    '#{foreach \$([()\w ]+) as \$([()\w ]+) =&gt; \$(\w+)}#',
    '{% for $2, $3 in $1 %}'
);

// {foreach $values as $value}...{/foreach} =&gt;
// {% for value in values %}...{% endfor %}
$content = Strings::replace($content, '#{foreach \$([()\w ]+) as \$([()\w ]+)}#', '{% for $2 in $1 %}');
$content = Strings::replace($content, '#{/foreach}#', '{% endfor %}');

// {sep}, {/sep} =&gt; {% if loop.last == false %}, {% endif %}
$content = Strings::replace($content, '#{sep}([^{]+){\/sep}#', '{% if loop.last == false %}$1{% endif %}');</code></pre>
<h3 id="7-Variables">7. Variables</h3>
<ul>
<li><a href="https://latte.nette.org/en/macros#toc-variable-printing">in Latte</a></li>
<li><a href="https://twig.symfony.com/doc/2.x/templates.html#variables">in Twig</a></li>
</ul>
<pre><code class="language-php">use Nette\Utils\Strings;

// ...

// {$google_analytics_tracking_id} =&gt;
// {{ google_analytics_tracking_id }}
// {$google_analytics_tracking_id|someFilter} =&gt;
// {{ google_analytics_tracking_id|someFilter }}
$content = Strings::replace($content, '#{\$(\w+)(\|.*?)?}#', '{{ $1$2 }}');

// {$post-&gt;getId()} =&gt;
// {{ post.getId() }}
$content = Strings::replace($content, '#{\$([\w]+)-&gt;([\w()]+)}#', '{{ $1.$2 }}');

// {$post['relativeUrl']} =&gt;
// {{ post.relativeUrl }}
$content = Strings::replace($content, '#{\$([A-Za-z_-]+)\[\'([A-Za-z_-]+)\'\]}#', '{{ $1.$2 }}');

// {% if $post['rectify_post_id'] is defined %} =&gt;
// {% if post.rectify_post_id is defined %}
$content = Strings::replace($content, '#({% \w+) \$(\w+)\[\'(\w+)\'\]#', '$1 $2.$3');</code></pre>
<p>This was the simplest set so far. Always start with the easiest first.</p>
<h3 id="8-Suffix">8. Suffix</h3>
<pre><code class="language-php">use Nette\Utils\Strings;

// ...

// "_snippets/menu.latte" =&gt;
// "_snippets/menu.twig"
$content = Strings::replace($content, '#([A-Za-z_/"]+).latte#', '$1.twig');</code></pre>
<h3 id="9-Include-With-Vars">9. Include With Vars</h3>
<p>This is the most complex solution in the set. What it does?</p>
<pre><code class="language-diff">-{% include "_snippets/menu.latte", "data" =&gt; $data %}
+{% include "_snippets/menu.twig" with { "data": data } %}</code></pre>
<p>It looks pretty simple, but I could not find an easier way to work with the nested array items.</p>
<pre><code class="language-php">use Nette\Utils\Strings;

// include var:
// {% include "_snippets/menu.latte", "data" =&gt; $data %} =&gt;
// {% include "_snippets/menu.twig", { "data": data } %}
// see https://twig.symfony.com/doc/2.x/functions/include.html
// single lines
// ref https://regex101.com/r/uDJaia/1
$content = Strings::replace($content, '#({% include [^,]+,)([^}^:]+)(\s+%})#', function (array $match) {
    $variables = explode(',', $match[2]);
    $twigDataInString = ' { ';
    $variableCount = count($variables);
    foreach ($variables as $i =&gt; $variable) {
        [$key, $value] = explode('=&gt;', $variable);
        $key = trim($key);
        $value = trim($value);
        $value = ltrim($value, '$'); // variables do not start with
        $twigDataInString .= $key . ': ' . $value;
        // separator
        if ($i &lt; $variableCount - 1) {
            $twigDataInString .= ', ';
        }
    }
    $twigDataInString .= ' }';

    return $match[1] . $twigDataInString . $match[3];
});

// {% include "sth", =&gt;
// {% include "sth" with
$content = Strings::replace($content, '#({% include [^,{]+)(,)#', '$1 with');</code></pre>
<p>What is here to take away? The <code>[^,{]+</code> set. It tells <em>find everything until the first <code>,</code> or <code>{</code> character</em>.
That way we catch everything we don't really work with.</p>
<h2 id="Install-and-Use-It">Install and Use It</h2>
<pre><code class="language-bash">composer require symplify/latte-to-twig-converter:@dev --dev
vendor/bin/latte-to-twig-converter convert app/templates</code></pre>
<p>It will find all the <code>*.twig</code> files, look for Latte code in it and if that matches, it will convert it to Twig. That way your <code>*.latte</code> files will keep Latte as long as you don't rename them.</p>
<p>I'd link you to <a href="https://github.com/symplify/lattetotwigconverter">README</a> now for more, but actually, there is no more, this is all the usage.</p>
<p><br></p>
<h3 id="How-Does-This-Set-Work-in-Real-Project">How Does This Set Work in Real Project?</h3>
<p>Just see <a href="https://github.com/TomasVotruba/tomasvotruba.com/pull/380">the PR on this website</a>
or <a href="https://github.com/pehapkari/pehapkari.cz/pull/486">the PR to Pehapkari.cz website</a>.</p>
<img src="/assets/images/posts/2018/latte-twig/diff.png" class="img-thumbnail">
<p><br></p>
<h2 id="Go-Out-and-Play">Go Out and Play</h2>
<p>In the end, I'd like to encourage you to do more of such experiments. I meet many programmers on meetups all across the Europe and they often don't have space - either the time in work or they won't allow themselves - to <strong>do such experiments</strong>.</p>
<p>In my open-source experience, these experiments give you the most knowledge. Instead of choosing the first solution because <em>I don't have time and I have to deliver the value</em>, I tried 3-4, tested them and then picked the one that worked the best. It was not the first one of course, and even if it was, I'd be much more convinced the solution is right instead of just blindly believing it.</p>
<p>I learned a lot about regular expressions, about delimiters and universal capturing groups (easter egg: seek &quot;http&quot; in the source code and you'll find all the tips I found and found useful) thanks to StackOverflow and <a href="https://regex101.com">regex101.com</a>. I also must thank Jáchym Toušek and Ondra Mirtes with PHPStan who got me more engaged in regular expressions in a useful and not-so-frustrating way.</p>
<p><br>
<br></p>
<p><strong>Free your mind and experiment! It's the best way to get better every iteration.</strong></p>

            <br>


            <div class="card mt-5 border-warning">
                <div class="card-body text-center mt-2">
                    <p>
                        Have you find this post useful? <strong>Do you want more?</strong>
                    </p>
                    <p>
                        Follow me on <a href="https://twitter.com/votrubaT">Twitter</a>, <a href="/rss.xml">RSS</a> or support me on <a href="https://github.com/sponsors/TomasVotruba">GitHub Sponsors</a>.
                    </p>
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-body text-white bg-success text-center">
                                            <a href="/blog/2018/07/02/cluster-more-interactive-than-book-deeper-than-post" class="d-block">
                            <div>
                                Read next → <strong>Cluster: More Interactive than a Book, Deeper than a Post</strong>
                            </div>
                        </a>
                                    </div>
            </div>

            <br>
            <br>

            <a name="comments"></a>
            <div id="disqus_thread"></div>

<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
    /*
    var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = 'https://itsworthsharing.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
        </div>

        <script id="dsq-count-scr" src="https://itsworthsharing.disqus.com/count.js" async defer></script>

        <link href="/assets/prism/prism.css" rel="stylesheet" type="text/css" />
        <script src="/assets/prism/prism.js"></script>

        <script>
    ga=function(){ ga.q.push(arguments) };
    ga.q=[];
    ga.l=+new Date;
    ga('create', 'UA-46082345-1', 'auto');
    ga('send','pageview');
</script>
<script src="https://www.google-analytics.com/analytics.js" async defer></script>

        <script type="text/javascript">
            // @see https://stackoverflow.com/a/30776817/1348344
            var date = new Date();
            // display every 2nd hour, not to spam users
            if (date.getHours() % 2 === 1) {
                document.querySelector('.book-banner').style.display = 'visible';
            } else {
                document.querySelector('.book-banner').style.display = 'none';
            }
        </script>
    </body>
</html>
