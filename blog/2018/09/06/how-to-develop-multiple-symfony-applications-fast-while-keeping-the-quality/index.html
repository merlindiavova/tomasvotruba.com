<!DOCTYPE html>
<html lang="en">
    <head>
        <title>How to Develop Multiple Symfony Applications Fast while Keeping the Quality | Tomas Votruba</title>
<meta charset="utf-8">
<meta name="robots" content="index, follow">

<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">

<meta name="twitter:card" content="summary"/>
<meta name="twitter:creator" content="@votrubaT"/>

<meta property="og:image" content="/assets/images/tomas_votruba.jpg"/>

<link rel="alternate" type="application/rss+xml" title="Tomas Votruba Blog RSS" href="/rss.xml">


<link rel="stylesheet" rel="preload" as="style" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:700&amp;display=swap" />

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous" media="print" onload="this.media='all'">

<link href="/assets/css/style.css?545087294" rel="stylesheet" type="text/css" />

                <meta property="og:title" content="How to Develop Multiple Symfony Applications Fast while Keeping the Quality" />
        <meta property="og:url" content="https://tomasvotruba.com/blog/2018/09/06/how-to-develop-multiple-symfony-applications-fast-while-keeping-the-quality" />
        <meta name="description" property="og:description" content="Do you take care of 2 or more projects on the same framework? Do you upgrade them both to the newest version of the framework from time to time?
Or maybe you&#039;re successful, you grow and have 10 such projects.

**Today I&#039;ll show you how to maintain speed while keeping the maintenance cost low**.
" />

                    <meta property="og:image" content="https://tomasvotruba.com/assets/images/posts/2018/multi-symfony/replace.png" />
            <meta name="twitter:card" content="summary_large_image"/>
            </head>

    <body>
                <!-- post_id: 138 -->
        <div id="menu">
    <div class="container-fluid">
        <a href="/">Home</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/blog">Blog</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/book/the-power-of-automated-refactoring">Book</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/trainings">Trainings</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/contact">Contact</a>
        <span class="pl-2 pr-2">•</span>

        <a href="https://twitter.com/votrubaT" target="blank">Twitter</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/rss.xml" target="blank">RSS</a>
    </div>
</div>

        <div class="container-fluid post" id="content">
            <h1>How to Develop Multiple Symfony Applications Fast while Keeping the Quality</h1>

            <div class="pull-right">
                <a href="https://github.com/tomasvotruba/tomasvotruba.com/edit/main/packages/blog/data/2018/2018-09-06-how-to-develop-multiple-symfony-applications-fast-while-keeping-the-quality.md">Found a typo? Edit me</a>
            </div>

            <time datetime="2018-09-Thu" class="text-muted">
                2018-09-06
            </time>

            
            
            <div class="card card-bigger mb-5">
                <div class="card-body pb-2">
                    <p>Do you take care of 2 or more projects on the same framework? Do you upgrade them both to the newest version of the framework from time to time?
Or maybe you're successful, you grow and have 10 such projects.
<br><br>
<strong>Today I'll show you how to maintain speed while keeping the maintenance cost low</strong>.</p>
                </div>
            </div>

            <p>This idea came originally from tech companies with large code bases and constantly growing products:</p>
<div class="text-center">
    <img src="/assets/images/posts/2018/multi-symfony/intro.png" class="img-thumbnail">
    <br>
    <em>From <a href="https://danluu.com/monorepo/">the first post about monorepo</a> there is</em>
</div>
<p><br></p>
<p>Yet I never saw such approach in PHP world. I mean, I saw monoliths but never a monorepo. Last year I started to work more closely with Shopsys and they did one crazy thing - <a href="https://github.com/shopsys/shopsys/tree/master/project-base">put the sandbox project into monorepo repository</a>. Instead of having 2 repositories - <strong>monorepo and showcase project separated</strong> - like <a href="https://github.com/symfony/symfony">Symfony</a> and its <a href="https://github.com/symfony/demo">Demo</a>, Laravel, CakePHP, Nette or basically any PHP framework I've seen, <strong> it is just one</strong>.</p>
<p>I had my concerns about how packages and project development will go together, but now I see it was just fear from unknown.</p>
<h2 id="i-hate-repetitive-work,-i-hate-repetitive-work">I hate Repetitive Work, I Hate Repetitive Work</h2>
<p>The fuel for the next step of this approach came last month. I'm currently working on 2 open-sourced Symfony Application (non CLI!) - <a href="https://github.com/TomasVotruba/open-training">open-training</a> and <a href="https://github.com/TomasVotruba/open-project">open-real-estate</a>.</p>
<p><strong>How are 2 Symfony applications different</strong>? Well, the entities, repository queries, templates, design and controller actions are unique.
But the PHP, used framework, bundle integration, database type, deploy strategy, own packages that <a href="https://github.com/TomasVotruba/open-project/tree/master/packages/auto-discovery">auto-discover entities</a> for example, Kernel boilerplate are the same.</p>
<p>One example from last month for all: I made first package that extends EasyAdminBundle (you can <a href="/blog/2018/08/20/painful-experience-over-solutions-extend-configuratin-in-easy-admin-bundle-with-collector">read it here</a>/) for <em>open-lecture</em> project. Of course, I need that for <em>open-real-estate</em>. Now I had to create a package, make own Github repository, register it on packagist, add it to other project and somehow switch between them for every update... ugh, I guess you would not want to pay me for this bureaucracy.</p>
<p>Since I'm the main investor of myself and I hate wasting time on repetitive work, I decided to give myself a question:</p>
<blockquote class="blockquote text-center">
    "Is possible to maintain 2 Symfony applications in a single repository with ease?"
</blockquote>
<p>Google answered by miss-leading <a href="https://jolicode.com/blog/multiple-applications-with-symfony2">Multiple Kernels</a> <a href="https://stackoverflow.com/questions/45925697/more-than-one-application-per-project-repository-with-symfony-4">for one Project</a>..</p>
<p><br></p>
<p>The goal is to run...</p>
<pre><code class="language-bash">*/bin/console server:run</code></pre>
<p>...and <strong>have a running website, with own database, own code and also no duplicated code</strong>.</p>
<p>After a few hours of playing with the code (my favorite game), I started to see light in the darkness.
I'm right in the very start of using this architecture, so you'll have the knowledge in the rawest form of fresh experience. It's easier to explain and understand, rather than something I do daily for the last 5 years and don't have to think about it.</p>
<h2 id="4-steps-to-turn-single-repository-project-to-parts-of-monorepo">4 Steps to turn Single-Repository project to Parts of Monorepo</h2>
<h3 id="1.-app-unique-namespace">1. <del>App</del> Unique Namespace</h3>
<p>If there are 2 <code>App\Kernel</code> classes the application would break. Pick a name that is specific for the project - here it's &quot;OpenTraining&quot; - and rename it in <code>namespace App\</code>, <code>namespace App;</code>, <code>use App\</code> in PHP code. Don't forget the <code>composer.json</code> as well.</p>
<div class="text-center">
    <img src="/assets/images/posts/2018/multi-symfony/replace.png" class="img-thumbnail">
    <br>
    <em>PHPStorm → Replace in path</em>
</div>
<pre><code class="language-diff">-namespace App;
+namespace OpenTraining;

 use Symfony\Component\HttpKernel\Kernel;

-final class AppKernel extends Kernel
+final class OpenTraining extends Kernel
 {
     // ...
 }</code></pre>
<p><br></p>
<p>And let composer know, what we did:</p>
<pre><code class="language-bash">composer dump-autoload</code></pre>
<h3 id="2.-fix-autoload-paths">2. Fix Autoload Paths</h3>
<ul>
<li><code>bin/console</code></li>
</ul>
<pre><code class="language-diff">-require __DIR__ . '/vendor/autoload.php';
+require getcwd() .'/vendor/autoload.php';

// ...</code></pre>
<ul>
<li><code>public/index.php</code></li>
</ul>
<p>This is more complicated because the working directory is not in the monorepo root but in the project root (<code>/projects/open-training</code>):</p>
<pre><code class="language-diff">-require __DIR__ . '/../vendor/autoload.php';

+$possibleAutoloadFiles = [
+    // project
+    __DIR__  .'/../vendor/autoload.php',
+    // monorepo
+    __DIR__  .'/../../../vendor/autoload.php',
+];

+foreach ($possibleAutoloadFiles as $possibleAutoloadFile) {
+    if (file_exists($possibleAutoloadFile)) {
+        require $possibleAutoloadFile;
+    }
+}</code></pre>
<h3 id="3.-bin\console">3. Bin\Console</h3>
<p>Instead of the old root as you're used to...</p>
<pre><code class="language-bash">bin/console server:run</code></pre>
<p>...you have to use projects' <code>bin/console</code>:</p>
<pre><code class="language-bash">projects/open-training/bin/console server:run
projects/open-real-estate/bin/console server:run</code></pre>
<h3 id="4.-merge-projects-composer">4. Merge Projects Composer</h3>
<p>You might be already wondering <em>How do manage composer dependencies in all this madness?</em> Well, you have to update projects' <code>composer.json</code> separately, pick them all and copy to root <code>composer.json</code>. And <strong>be careful</strong> not to use different versions, it might cause the project to work on monorepo but fail after deploying on production...</p>
<p><em>Just kidding</em>, you know I'm too lazy for this</p>
<p>All you need to do is to update projects' <code>composer.json</code>. For the rest, there is a tool I use to manage Symplify monorepo dependencies that does the dirty work for you:</p>
<pre><code class="language-bash">composer require symplify/monorepo-builder

# make sure there is the same version for every package in every composer.json
vendor/bin/monorepo-builder validate

# merge "require", "require-dev", "autoload" and "autoload-dev" from projects to the root composer.json
vendor/bin/monorepo-builder merge

# to make sure we have installed projects' dependencies
composer update</code></pre>
<p>In the root <code>composer.json</code> you might want to add some coding standards and static analysis, that is not in projects.
See the <a href="https://github.com/TomasVotruba/open-project/blob/master/monorepo-builder.yml"><code>monorepo-builder.yml</code> config </a> in my <a href="https://github.com/TomasVotruba/open-project">open-project</a> monorepo repository to get the idea how to configure it.</p>
<p><br></p>
<p>And that's it! We have now one repository to maintain, no matter how many projects we have, and we met our goals:</p>
<ul>
<li>We have the entities, repository queries, templates, design and controller actions <strong>are unique</strong>.</li>
<li>PHP, used framework, bundle integration, database type, deploy strategy, own packages, Kernel boilerplate <strong>are the same</strong>.</li>
</ul>
<p>Now we can run application with <code>projects/open-training/bin/console server:run</code> and it works!</p>
<p><br></p>
<p>Happy maintaining!</p>

            <br>


            <div class="card mt-5 border-warning">
                <div class="card-body text-center mt-2">
                    <p>
                        Have you find this post useful? <strong>Do you want more?</strong>
                    </p>
                    <p>
                        Follow me on <a href="https://twitter.com/votrubaT">Twitter</a>, <a href="/rss.xml">RSS</a> or support me on <a href="https://github.com/sponsors/TomasVotruba">GitHub Sponsors</a>.
                    </p>
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-body text-white bg-success text-center">
                    
                                            <a href="/blog/2018/09/03/4-ways-to-add-global-option-or-argument-to-symfony-console-application" class="d-block">
                            <div>
                                Read next → <strong>4 Ways to Add Global Option or Argument to Symfony Console Application</strong>
                            </div>
                        </a>
                                    </div>
            </div>

            <br>
            <br>

            <a name="comments"></a>
            <div id="disqus_thread"></div>

<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
    /*
    var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = 'https://itsworthsharing.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
        </div>

        <script id="dsq-count-scr" src="https://itsworthsharing.disqus.com/count.js" async defer></script>

        <link href="/assets/prism/prism.css" rel="stylesheet" type="text/css" />
        <script src="/assets/prism/prism.js"></script>

        <script>
    ga=function(){ ga.q.push(arguments) };
    ga.q=[];
    ga.l=+new Date;
    ga('create', 'UA-46082345-1', 'auto');
    ga('send','pageview');
</script>
<script src="https://www.google-analytics.com/analytics.js" async defer></script>
    </body>
</html>
