<!DOCTYPE html>
<html lang="en">
    <head>
        <title>New in Symplify 5: 3 New Cool Features of PackageBuilder | Tomas Votruba</title>
<meta charset="utf-8">
<meta name="robots" content="index, follow">

<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">

<meta name="twitter:card" content="summary"/>
<meta name="twitter:creator" content="@votrubaT"/>

    <meta property="og:title" content="New in Symplify 5: 3 New Cool Features of PackageBuilder" />
    <meta property="og:url" content="https://tomasvotruba.com/blog/2018/09/20/new-in-symplify-5-3-new-cool-features-of-package-builder" />

            <meta property="og:image" content="https://tomasvotruba.com/assets/images/tomas_votruba.jpg"/>
        <meta name="twitter:image" content="https://tomasvotruba.com/assets/images/tomas_votruba.jpg"/>
    
<link rel="alternate" type="application/rss+xml" title="Tomas Votruba Blog RSS" href="/rss.xml">


<link rel="stylesheet" rel="preload" as="style" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:700&amp;display=swap" />

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous" media="print" onload="this.media='all'">

<link href="/assets/css/style.css?2004908087" rel="stylesheet" type="text/css" />

                <meta name="description" property="og:description" content="[PackageBuilder](https://github.com/symplify/package-builder) was always sort of meta package with all **the cool and shiny features anyone can use**. After all, it&#039;s the most downloaded Symplify package hitting almost [1000 downloads a day](https://packagist.org/packages/symplify/package-builder/stats).


In Symplify 5 now it allows you to **drop manual binds** from Symfony configs, separate files from directories **in one method** and merge nested YAML parameters **with 1&amp;nbsp;service**.
" />
    </head>

    <body>
        <!-- post_id: 145 -->
        <div id="menu">
    <div class="container-fluid">
        <a href="/">Home</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/blog">Blog</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/book/the-power-of-automated-refactoring">Book</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/trainings">Trainings</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/contact">Contact</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/about-me">About Me</a>
        <span class="pl-2 pr-2">•</span>

        <a href="https://twitter.com/votrubaT" target="blank">Twitter</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/rss.xml" target="blank">RSS</a>
    </div>
</div>

        <div class="container-fluid post" id="content">
            <div class="text-center book-banner">
                <a href="https://leanpub.com/rector-the-power-of-automated-refactoring" target="blank" class="text-center">
                    <img src="/assets/images/banner-rector-book.png" class="mb-2 ml-auto mr-auto rounded " style="max-height: 5em" alt="">
                </a>
            </div>

            <h1>New in Symplify 5: 3 New Cool Features of PackageBuilder</h1>

            <div class="pull-right">
                <a href="https://github.com/tomasvotruba/tomasvotruba.com/edit/main/packages/blog/data/2018/2018-09-20-new-in-symplify-5-3-new-cool-features-of-package-builder.md">Found a typo? Edit me</a>
            </div>

            <time datetime="2018-09-Thu" class="text-muted">
                2018-09-20
            </time>

            
            
            <div class="card card-bigger mb-5">
                <div class="card-body pb-2">
                    <p><a href="https://github.com/symplify/package-builder">PackageBuilder</a> was always sort of meta package with all <strong>the cool and shiny features anyone can use</strong>. After all, it's the most downloaded Symplify package hitting almost <a href="https://packagist.org/packages/symplify/package-builder/stats">1000 downloads a day</a>.
<br>
<br>
In Symplify 5 now it allows you to <strong>drop manual binds</strong> from Symfony configs, separate files from directories <strong>in one method</strong> and merge nested YAML parameters <strong>with 1&nbsp;service</strong>.</p>
                </div>
            </div>

            <p>You don't have this package installed yet?</p>
<pre><code class="language-bash">composer require symplify/package-builder</code></pre>
<p>Now enjoy the news ↓</p>
<h2 id="1-Drop-Manual-Binds-in-Symfony-configs">1. Drop Manual Binds in Symfony configs</h2>
<p><a href="https://github.com/symplify/symplify/pull/998" class="btn btn-dark btn-sm">
See pull-request #998
</a></p>
<p>You can add <a href="https://symfony.com/blog/new-in-symfony-3-4-local-service-binding">parameter binding since Symfony 3.4</a>:</p>
<pre><code class="language-yaml">services:
    _defaults:
        bind:
            $meetupComApiKey: '%meetup_com_api_key%'</code></pre>
<p>That's nice. But what if you have multiple configs that use multiple parameters?</p>
<pre><code class="language-yaml">services:
    _defaults:
        bind:
            $meetupComApiKey: '%meetup_com_api_key%'
            $facebookApiKey: '%facebook_api_key%'
            $maxPostOnHomepage: '%max_post_on_homepage%'

    App\FirstPackage\:
        resource: ..</code></pre>
<pre><code class="language-yaml">services:
    _defaults:
        bind:
            $facebookApiKey: '%facebook_api_key%'
            $maxPostOnHomepage: '%max_post_on_homepage%'

    App\SecondPackage\:
        resource: ..</code></pre>
<h3 id="Not-for-Lazy-Programmer">Not for Lazy Programmer</h3>
<p>This way you'll be writing more bindings than there are parameters. And there is more! When you remove autodiscovered service that depends on a bound parameter, you'll get this &quot;nice&quot; exception:</p>
<blockquote class="blockquote">
    Unused binding "maxPostOnHomepage" in service "App\SomeUnterlatedService"
</blockquote>
<p>You can solve this all by having a huge config with all parameters, binding and services. Even if the config would be shorter than 100 lines, you still have to maintain parameters, bindings and services and it teaches other programmers to <em>put-everything-to-one-place</em> instead of SOLID principles.</p>
<p><br></p>
<p><strong>Would you like to get rid of this all extra maintenance, and just code cleanly instead?</strong> I would!</p>
<p>So, have you noticed the pattern?</p>
<ul>
<li><code>$variableName</code> &lt;=&gt; <code>%parameter_name</code></li>
<li><code>camelCase</code> &lt;=&gt; <code>underscore_case</code></li>
</ul>
<p>And exactly this can be automated! Just add <code>Symplify\PackageBuilder\DependencyInjection\CompilerPass\AutoBindParametersCompilerPass</code> compiler pass:</p>
<pre><code class="language-diff">&lt;?php

    // ...

 use Symfony\Component\DependencyInjection\ContainerBuilder;
 use Symfony\Component\HttpKernel\Kernel;
+use Symplify\PackageBuilder\DependencyInjection\CompilerPass\AutoBindParametersCompilerPass;

 final class YourAppKernel extends Kernel
 {
     // ...

+    protected function build(ContainerBuilder $containerBuilder): void
+    {
+        $containerBuilder-&gt;addCompilerPass(new AutoBindParametersCompilerPass());
+    }
 }</code></pre>
<p>And if you keep this convention, you can keep yours configs clear and minimalistic:</p>
<pre><code class="language-diff"> services:
-    _defaults:
-        bind:
-            $meetupComApiKey: '%meetup_com_api_key%'
-            $facebookApiKey: '%facebook_api_key%'
-            $maxPostOnHomepage: '%max_post_on_homepage%'</code></pre>
<p>Of course you can bind your parameters manually:</p>
<pre><code class="language-yaml">services:
    _defaults:
        bind:
            $anotherName: '%non_standard_parameter_naming%'

    SomeClass:
        arguments:
            - '%very_specfici_meetup_com_api_key%'</code></pre>
<h2 id="2-Separate-Files-from-Directories">2. Separate Files from Directories</h2>
<p><a href="https://github.com/symplify/symplify/pull/963" class="btn btn-dark btn-sm">
See pull-request #963
</a></p>
<p>Do you need to work multiple file/directories arguments?</p>
<pre><code class="language-bash">vendor/bin/ecs check src tests/ThisFile.php</code></pre>
<p>Just use <code>Symplify\PackageBuilder\FileSystem\FileSystem</code>:</p>
<pre><code class="language-php">&lt;?php

$sources = [
   __DIR__ . '/SomeDirectory',
   __DIR__ . '/SomeFile.php'
];

$symplifyFileSystem = new Symplify\PackageBuilder\FileSystem\FileSystem;
[$files, $directories] = $symplifyFileSystem-&gt;separateFilesAndDirectories($sources);

// ...</code></pre>
<h2 id="3-Merge-Parameters-without-Leaving-Any-Behind">3. Merge Parameters without Leaving Any Behind</h2>
<p><a href="https://github.com/symplify/symplify/pull/989" class="btn btn-dark btn-sm">
See pull-request #989
</a></p>
<p>At the moment, Symfony is unable to merge nested parameters <a href="https://github.com/symfony/symfony/issues/26713">for historical and other reasons</a>:</p>
<pre><code class="language-yaml"># config.yml
imports:
    - { resource: 'imported-file.yml' }

parameters:
    festivals:
        - three</code></pre>
<pre><code class="language-yaml"># imported-file.yml
parameters:
    festivals:
        - one
        - two</code></pre>
<p>This will end up with just 1 festival in classic Symfony Applicatoin. Do you want to use the <strong>full power of YAML, glob and imports</strong> and <strong>still keep all the parameters</strong>?</p>
<p>Use <code>Symplify\PackageBuilder\Yaml\ParameterMergingYamlLoader</code>:</p>
<pre><code class="language-php">&lt;?php

$parametersMergingYamlLoader = new Symplify\PackageBuilder\Yaml\ParameterMergingYamlLoader;
$parameterBag = $parametersMergingYamlLoader-&gt;loadParameterBagFromFile(
    __DIR__ . '/config.yml'
);

var_dump($parameterBag-&gt;get('festivals'));
// ['one', 'two', 'three']</code></pre>
<p><br></p>
<p>And that's all folks!</p>
<p><br></p>
<p>Happy tuning of your code!</p>

            <br>


            <div class="card mt-5 border-warning">
                <div class="card-body text-center mt-2">
                    <p>
                        Have you find this post useful? <strong>Do you want more?</strong>
                    </p>
                    <p>
                        Follow me on <a href="https://twitter.com/votrubaT">Twitter</a>, <a href="/rss.xml">RSS</a> or support me on <a href="https://github.com/sponsors/TomasVotruba">GitHub Sponsors</a>.
                    </p>
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-body text-white bg-success text-center">
                                            <a href="/blog/2018/10/08/new-in-symplify-5-create-merge-and-split-monorepo-with-1-command" class="d-block">
                            <div>
                                Read next → <strong>New in Symplify 5: Create, Merge and Split Monorepo with 1 Command</strong>
                            </div>
                        </a>
                                    </div>
            </div>

            <br>
            <br>

            <a name="comments"></a>
            <div id="disqus_thread"></div>

<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
    /*
    var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = 'https://itsworthsharing.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
        </div>

        <script id="dsq-count-scr" src="https://itsworthsharing.disqus.com/count.js" async defer></script>

        <link href="/assets/prism/prism.css" rel="stylesheet" type="text/css" />
        <script src="/assets/prism/prism.js"></script>

        <script>
    ga=function(){ ga.q.push(arguments) };
    ga.q=[];
    ga.l=+new Date;
    ga('create', 'UA-46082345-1', 'auto');
    ga('send','pageview');
</script>
<script src="https://www.google-analytics.com/analytics.js" async defer></script>

        <script type="text/javascript">
            // @see https://stackoverflow.com/a/30776817/1348344
            var date = new Date();
            // display every 2nd hour, not to spam users
            if (date.getHours() % 2 === 1) {
                document.querySelector('.book-banner').style.display = 'visible';
            } else {
                document.querySelector('.book-banner').style.display = 'none';
            }
        </script>
    </body>
</html>
