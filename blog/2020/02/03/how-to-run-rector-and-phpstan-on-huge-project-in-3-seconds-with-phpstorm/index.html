<!DOCTYPE html>
<html lang="en">
    <head>
        <title>How to run Rector and PHPStan on Huge Project in 3 Seconds with PHPStorm | Tomas Votruba</title>
<meta charset="utf-8">
<meta name="robots" content="index, follow">

<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">

<meta name="twitter:card" content="summary"/>
<meta name="twitter:creator" content="@votrubaT"/>

    <meta property="og:image" content="https://tomasvotruba.com/assets/images/posts/2020/external_tools_rector.gif" />
    <meta property="og:title" content="How to run Rector and PHPStan on Huge Project in 3 Seconds with PHPStorm" />
    <meta property="og:url" content="https://tomasvotruba.com/blog/2020/02/03/how-to-run-rector-and-phpstan-on-huge-project-in-3-seconds-with-phpstorm" />

    <meta name="twitter:image" content="https://tomasvotruba.com/assets/images/posts/2020/external_tools_rector.gif"/>

<link rel="alternate" type="application/rss+xml" title="Tomas Votruba Blog RSS" href="/rss.xml">


<link rel="stylesheet" rel="preload" as="style" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:700&amp;display=swap" />

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous" media="print" onload="this.media='all'">

<link href="/assets/css/style.css?2121938571" rel="stylesheet" type="text/css" />

                <meta name="description" property="og:description" content="Today we&#039;ll look at the command line and run performance heavy dev tools like Rector or PHPStan on our projects. I&#039;m guessing that it takes more than 10 seconds to run whatever project you use.


How would you like it be **less than 3 seconds with just one click** in PHPStorm?
" />
    </head>

    <body>
        <!-- post_id: 237 -->
        <div id="menu">
    <div class="container-fluid">
        <a href="/">Home</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/blog">Blog</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/book/the-power-of-automated-refactoring">Book</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/trainings">Trainings</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/contact">Contact</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/about-me">About Me</a>
        <span class="pl-2 pr-2">•</span>

        <a href="https://twitter.com/votrubaT" target="blank">Twitter</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/rss.xml" target="blank">RSS</a>
    </div>
</div>

        <div class="container-fluid post" id="content">
            <div class="text-center book-banner">
                <a href="https://leanpub.com/rector-the-power-of-automated-refactoring" target="blank" class="text-center">
                    <img src="/assets/images/banner-rector-book.png" class="mb-2 ml-auto mr-auto rounded " style="max-height: 5em" alt="">
                </a>
            </div>

            <h1>How to run Rector and PHPStan on Huge Project in 3 Seconds with PHPStorm</h1>

            <div class="pull-right">
                <a href="https://github.com/tomasvotruba/tomasvotruba.com/edit/main/packages/blog/data/2020/2020-02-03-how-to-run-rector-and-phpstan-on-huge-project-in-3-seconds-with-phpstorm.md">Found a typo? Edit me</a>
            </div>

            <time datetime="2020-02-Mon" class="text-muted">
                2020-02-03
            </time>

            
            
            <div class="card card-bigger mb-5">
                <div class="card-body pb-2">
                    <p>Today we'll look at the command line and run performance heavy dev tools like Rector or PHPStan on our projects. I'm guessing that it takes more than 10 seconds to run whatever project you use.
<br>
<br>
How would you like it be <strong>less than 3 seconds with just one click</strong> in PHPStorm?</p>
                </div>
            </div>

            <p>Let's say we have a reasonably big codebase, like Rector, with over 70 000 lines of code. Projects I consult lately usually fit into 200-600 000 lines of code, though. But let's take Rector as the baseline, as that's the project we have data for.</p>
<p>We add a new feature, change test, fix a bug, 300 added lines, 200 removed.</p>
<p>Now, <strong>we want to run Rector and PHPStan to make sure the code is clean and working</strong>. So we run PHPStan:</p>
<img src="/assets/images/posts/2020/external_tools_normal_phpstan.gif" class="img-thumbnail">
<p>And wait...</p>
<p><br>
<br>
<br></p>
<p>...<strong>40 seconds</strong>!</p>
<p><br></p>
<h2 id="How-do-we-Hack-It">How do we Hack It?</h2>
<p>It takes so long. We might adapt and <strong>push it into the remote repository and let the CI server handle it</strong>. After all, it's often much faster than our local laptop. I used this approach at big codebases so far.</p>
<p>Another way is to copy the directory path and run tool only on it:</p>
<pre><code class="language-bash">vendor/bin/phpstan analyse src/SomeDirectory
vendor/bin/rector process src/SomeDirectory</code></pre>
<p>But we have to:</p>
<ul>
<li>copy directory path or type it</li>
<li>open command line</li>
<li>type whole command we usually use</li>
<li>remove argument we typically use</li>
<li>add our directory argument</li>
<li>click to run it</li>
</ul>
<p>Instant flow killer :(</p>
<h2 id="Too-Slow-Go-Home">Too Slow? Go Home!</h2>
<p>When I talk with developers, this is one of the main reasons they don't use such tools. It takes too long to get feedback from them. It destroys their focus on the features.</p>
<blockquote class="blockquote text-center mt-5 mb-5">
Frustration is always the sign we should ask this question:
<br>
How can we do better?
</blockquote>
<p><br></p>
<h2 id="Narrow-Scope-Increase-Focus">Narrow Scope → Increase Focus</h2>
<p>Last week <a href="https://twitter.com/mikes_honza">Honza</a> showed me PHPStorm tip that fits <a href="/blog/2020/01/27/switch-travis-to-github-actions-to-reduce-stress/">into instant feedback loop flow</a> I discovered recently.</p>
<p><a href="https://twitter.com/mikes_honza/status/1222557580507127811"></p>
<img src="/assets/images/posts/2020/external_tools_tweet.png" class="img-thumbnail">
<p></a></p>
<p><strong>It might trim off some more frustration</strong> in your daily work and turn you into a flow developer as a result. The bigger your codebase, the more it might help you get under 3 seconds.</p>
<p><br></p>
<h2 id="How-does-it-Work">How does it Work?</h2>
<p>You run <strong>the tool only on a selected directory in the left tree</strong>.</p>
<ul>
<li>Without the command line.</li>
<li>Without changing paths.</li>
<li>Without copy-pasting.</li>
</ul>
<h3 id="Domain-Directory-Separation">Domain Directory Separation</h3>
<p>This approach requires us to keep a decoupled structure, e.g., with to <a href="/blog/2017/12/25/composer-local-packages-for-dummies/">local packages</a> or domain-driven design.</p>
<p>What does it mean? That our code that handles security is not all over the place in <code>/src</code> directory but in standalone <code>packages/Security</code> directory. So if we work with security, we <del>only</del> mostly work in that directory.</p>
<h2 id="How-to-Configure-External-Tool-in-PHPStorm">How to Configure External Tool in PHPStorm?</h2>
<p>In PHPStorm open:</p>
<ul>
<li>Settings →</li>
<li>Tools →</li>
<li>External Tools</li>
</ul>
<p><br></p>
<p>Click on <em>+</em>:</p>
<img src="/assets/images/posts/2020/external_tool_add.png" class="img-thumbnail">
<p><br></p>
<p><strong>Name the tool and configure parameters</strong></p>
<ul>
<li>Program: <code>$ProjectFileDir$/vendor/bin/rector</code></li>
<li>Arguments: <code>process $FilePathRelativeToProjectRoot$</code></li>
<li>Working directory: <code>$ProjectFileDir$</code></li>
</ul>
<img src="/assets/images/posts/2020/external_tools_one.png" class="img-thumbnail">
<p><br></p>
<p>Save.</p>
<h2 id="How-to-Use-It">How to Use It?</h2>
<p>Pick the directory you want to process in the file tree.</p>
<p>Run action.</p>
<p>Type &quot;Rector&quot; or &quot;PHPStan&quot; and hit enter:</p>
<img src="/assets/images/posts/2020/external_tools_rector.gif" class="img-thumbnail">
<p><br></p>
<p>Kaboom :) That's it!</p>
<p><br></p>
<p>Happy flow coding!</p>

            <br>


            <div class="card mt-5 border-warning">
                <div class="card-body text-center mt-2">
                    <p>
                        Have you find this post useful? <strong>Do you want more?</strong>
                    </p>
                    <p>
                        Follow me on <a href="https://twitter.com/votrubaT">Twitter</a>, <a href="/rss.xml">RSS</a> or support me on <a href="https://github.com/sponsors/TomasVotruba">GitHub Sponsors</a>.
                    </p>
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-body text-white bg-success text-center">
                                            <a href="/blog/2020/01/27/switch-travis-to-github-actions-to-reduce-stress" class="d-block">
                            <div>
                                Read next → <strong>Switch Travis to GitHub Actions to Reduce Stress</strong>
                            </div>
                        </a>
                                    </div>
            </div>

            <br>
            <br>

            <a name="comments"></a>
            <div id="disqus_thread"></div>

<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
    /*
    var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = 'https://itsworthsharing.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
        </div>

        <script id="dsq-count-scr" src="https://itsworthsharing.disqus.com/count.js" async defer></script>

        <link href="/assets/prism/prism.css" rel="stylesheet" type="text/css" />
        <script src="/assets/prism/prism.js"></script>

        <script>
    ga=function(){ ga.q.push(arguments) };
    ga.q=[];
    ga.l=+new Date;
    ga('create', 'UA-46082345-1', 'auto');
    ga('send','pageview');
</script>
<script src="https://www.google-analytics.com/analytics.js" async defer></script>

        <script type="text/javascript">
            // @see https://stackoverflow.com/a/30776817/1348344
            var date = new Date();
            // display every 2nd hour, not to spam users
            if (date.getHours() % 2 === 1) {
                document.querySelector('.book-banner').style.display = 'visible';
            } else {
                document.querySelector('.book-banner').style.display = 'none';
            }
        </script>
    </body>
</html>
