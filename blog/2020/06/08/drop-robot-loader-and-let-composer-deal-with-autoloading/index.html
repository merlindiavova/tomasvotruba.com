<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Drop RobotLoader and let Composer Deal with Autoloading | Tomas Votruba</title>
<meta charset="utf-8">
<meta name="robots" content="index, follow">

<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">

<meta name="twitter:card" content="summary"/>
<meta name="twitter:creator" content="@votrubaT"/>

<meta property="og:image" content="/assets/images/tomas_votruba.jpg"/>

<link rel="alternate" type="application/rss+xml" title="Tomas Votruba Blog RSS" href="/rss.xml">


<link rel="stylesheet" rel="preload" as="style" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:700&amp;display=swap" />

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous" media="print" onload="this.media='all'">

<link href="/assets/css/style.css?478243934" rel="stylesheet" type="text/css" />

                <meta property="og:title" content="Drop RobotLoader and let Composer Deal with Autoloading" />
        <meta property="og:url" content="https://tomasvotruba.com/blog/2020/06/08/drop-robot-loader-and-let-composer-deal-with-autoloading" />
        <meta name="description" property="og:description" content="Using 2 tools for one thing, in this case 2 packages to autoload classes, are sign of an architecture smell. Many applications I see contain RobotLoader for historical reasons. I will borrow this from psychology: pathological behavioral patterns tear us down in the present, but were useful in past.

The best way to deal with them is acknowledge their purpose and then, let them go and enjoy the gift of present.
" />

            </head>

    <body>
        <!-- post_id: 255 -->
        <div id="menu">
    <div class="container-fluid">
        <a href="/">Home</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/blog">Blog</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/book/the-power-of-automated-refactoring">Book</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/trainings">Trainings</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/contact">Contact</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/about-me">About Me</a>
        <span class="pl-2 pr-2">•</span>

        <a href="https://twitter.com/votrubaT" target="blank">Twitter</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/rss.xml" target="blank">RSS</a>
    </div>
</div>

        <div class="container-fluid post" id="content">
            <div class="text-center book-banner">
                <a href="https://leanpub.com/rector-the-power-of-automated-refactoring" target="blank" class="text-center">
                    <img src="/assets/images/banner-rector-book.png" class="mb-2 ml-auto mr-auto rounded " style="max-height: 5em" alt="">
                </a>
            </div>

            <h1>Drop RobotLoader and let Composer Deal with Autoloading</h1>

            <div class="pull-right">
                <a href="https://github.com/tomasvotruba/tomasvotruba.com/edit/main/packages/blog/data/2020/2020-06-08-drop-robot-loader-and-let-composer-deal-with-autoloading.md">Found a typo? Edit me</a>
            </div>

            <time datetime="2020-06-Mon" class="text-muted">
                2020-06-08
            </time>

            
            
            <div class="card card-bigger mb-5">
                <div class="card-body pb-2">
                    <p>Using 2 tools for one thing, in this case 2 packages to autoload classes, are sign of an architecture smell. Many applications I see contain RobotLoader for historical reasons. I will borrow this from psychology: pathological behavioral patterns tear us down in the present, but were useful in past.
<br><br>
The best way to deal with them is acknowledge their purpose and then, let them go and enjoy the gift of present.</p>
                </div>
            </div>

            <h2 id="Where-is-RobotLoader-Useful">Where is RobotLoader Useful</h2>
<p><a href="https://doc.nette.org/en/auto-loading#toc-nette-loaders-robotloader">RobotLoader</a> is a Nette Component that is used to autoload classes. Its killer feature is simple: <strong>in whatever file it is and whatever the class name is, I will load it</strong>. You can have 20 classes in 1 file or classes located in various locations, they won't hide.</p>
<h2 id="Before-Composer-appeared-it-was-The-Best">Before Composer appeared, it was The Best</h2>
<p>RobotLoader was a very useful tool in times before Composer, because <strong>there were not so many efficient tools for loading classes</strong>.</p>
<p>Also, when people could not agree upon where to put their classes, how to name them, whether use or don't use namespace and how many classes to put in one file, we can say <strong>this tool saved a lot of argument-hours</strong>.</p>
<p>After many discussions, followed by the first standard, <a href="http://www.php-fig.org/psr/psr-0">PSR-0</a>, people agreed upon <a href="http://www.php-fig.org/psr/psr-4">PSR-4</a>, a more mature replacement of PSR-0.</p>
<h2 id="Why-it-s-not-Anymore">Why it's not Anymore</h2>
<p>Have your heard about PSR-4? It is a <em>PHP Standard Recommendation</em> about naming and location of the classes. This says you completely nothing, but in the simplest form it means:</p>
<p><strong>1 class</strong> (or interface/trait) = <strong>1 file</strong></p>
<p><strong>class name</strong> = <strong>file name</strong>.php</p>
<p><strong>namespace\class name</strong> = <strong>directory/file name</strong>.php</p>
<pre><code class="language-bash"># class =&gt; file
MyClass =&gt; MyClass.php
App\MyClass =&gt; App/MyClass.php
App\Presenter\MyClass =&gt; App/Presenter/MyClass.php</code></pre>
<p>I know I can rely on this in 99% of places when <code>composer.json</code> is used.</p>
<p>When I see <code>App\Presenter\MyClass</code> I  it's located in <code>App/Presenter/MyClass.php</code> file.</p>
<p>And this is the place where <strong>RobotLoader</strong> (or any custom ultimate loader) <strong>fails</strong>. I came around many applications where classes are located at random. And I had to use my brain to find them. But I don't want to focus my mental activity on thinking about their location, <strong>I want to develop my application</strong>.</p>
<h2 id="How-to-move-to-Composer-in-a-Nette-application">How to move to Composer in a Nette application?</h2>
<p>There are 2 levels of how to achieve this.</p>
<h3 id="Level-1-Change-your-Composer">Level 1: Change your Composer</h3>
<p>The first level requires 3 small steps.</p>
<h4 id="1-Tune-composer-json-Autoloading">1. Tune <code>composer.json</code> Autoloading</h4>
<pre><code class="language-json">{
    "require": {
        "..."
    },
    "autoload": {
        "psr-4": {
            "App\\Forms\\": "app/forms",
            "App\\Model\\": "app/model",
            "App\\Presenters\\": "app/presenters",
            "App\\Router\\": "app/router"
        }
    }
}</code></pre>
<p>This means, all classes residing in <code>App\\Forms</code> namespace have to be located in <code>app/forms</code> directory.</p>
<p>One important rule - it works in <strong>case-sensitive</strong> manner.</p>
<p>So this will work:</p>
<pre><code class="language-bash">App\Presenters\HomepagePresenter =&gt; app/presenters/HomepagePresenter.php</code></pre>
<p>But this will not:</p>
<pre><code class="language-bash">App\Presenters\HomepagePresenter =&gt; app/presenters/homepagePresenter.php</code></pre>
<h4 id="2-Disable-RobotLoader">2. Disable RobotLoader</h4>
<p>Now you can clean up your <code>app/bootstrap.php</code>:</p>
<pre><code class="language-php">// $configurator-&gt;createRobotLoader()
//      -&gt;addDirectory(__DIR__)
//      -&gt;register();</code></pre>
<p>But RobotLoader is still silently enabled for presenters. We don't want that either now:</p>
<pre><code class="language-yaml"># app/config/config.neon
application:
    scanDirs: false</code></pre>
<h4 id="3-Refresh-Composer-Autoloading">3. Refresh Composer Autoloading</h4>
<p>And tell Composer, to regenerate its autoloader:</p>
<pre><code class="language-bash">composer dump-autoload</code></pre>
<p>Note: This command is run by default after <code>composer update</code>, <code>composer require ...</code> and similar commands. Since we'd manually changed our <code>autoload</code> section, we had to run it manually.</p>
<p>Now try our application and it should run.</p>
<p><strong>You are finished and all your classes are loaded by Composer.</strong> Congratulations!</p>
<h3 id="Level-2-Rename-Directories-to-capital-case-to-Respect-PSR-4">Level 2: Rename Directories to capital case, to Respect PSR-4</h3>
<p>There is one more level I do with my applications, so my <code>composer.json</code> is nice and clear. But this is optional. Do it only if you'd like to write better code with lower WTF factor!</p>
<p>Turn this:</p>
<pre><code class="language-bash">/app
    /forms
    /model
    /presenters
    /routing
    /...</code></pre>
<p>Into this:</p>
<pre><code class="language-bash">/app
    /Forms
    /Model
    /Presenters
    /Routing
    /...</code></pre>
<p>After these steps, you can simplify your <code>autoload</code> section as such:</p>
<pre><code class="language-json">{
    "autoload": {
        "psr-4": {
            "App\\": "app"
        }
    }
}</code></pre>
<p>Don't forget to run:</p>
<pre><code class="language-bash">composer dump-autoload</code></pre>
<p>And you've unlocked Level 2.</p>
<p><br></p>
<p>Happy coding!</p>

            <br>


            <div class="card mt-5 border-warning">
                <div class="card-body text-center mt-2">
                    <p>
                        Have you find this post useful? <strong>Do you want more?</strong>
                    </p>
                    <p>
                        Follow me on <a href="https://twitter.com/votrubaT">Twitter</a>, <a href="/rss.xml">RSS</a> or support me on <a href="https://github.com/sponsors/TomasVotruba">GitHub Sponsors</a>.
                    </p>
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-body text-white bg-success text-center">
                                            <a href="/blog/2020/06/01/inject-or-required-will-get-you-any-service-fast" class="d-block">
                            <div>
                                Read next → <strong>@inject or @required will Get You Any Services Fast</strong>
                            </div>
                        </a>
                                    </div>
            </div>

            <br>
            <br>

            <a name="comments"></a>
            <div id="disqus_thread"></div>

<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
    /*
    var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = 'https://itsworthsharing.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
        </div>

        <script id="dsq-count-scr" src="https://itsworthsharing.disqus.com/count.js" async defer></script>

        <link href="/assets/prism/prism.css" rel="stylesheet" type="text/css" />
        <script src="/assets/prism/prism.js"></script>

        <script>
    ga=function(){ ga.q.push(arguments) };
    ga.q=[];
    ga.l=+new Date;
    ga('create', 'UA-46082345-1', 'auto');
    ga('send','pageview');
</script>
<script src="https://www.google-analytics.com/analytics.js" async defer></script>

        <script type="text/javascript">
            // @see https://stackoverflow.com/a/30776817/1348344
            var date = new Date();
            // display every 2nd hour, not to spam users
            if (date.getHours() % 2 === 1) {
                document.querySelector('.book-banner').style.display = 'visible';
            } else {
                document.querySelector('.book-banner').style.display = 'none';
            }
        </script>
    </body>
</html>
