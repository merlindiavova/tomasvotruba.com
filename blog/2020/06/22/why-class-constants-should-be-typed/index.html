<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Why Class Constants Should be Typed | Tomas Votruba</title>
<meta charset="utf-8">
<meta name="robots" content="index, follow">

<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">

<meta name="twitter:card" content="summary"/>
<meta name="twitter:creator" content="@votrubaT"/>

<meta property="og:image" content="/assets/images/tomas_votruba.jpg"/>

<link rel="alternate" type="application/rss+xml" title="Tomas Votruba Blog RSS" href="/rss.xml">


<link rel="stylesheet" rel="preload" as="style" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:700&amp;display=swap" />

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous" media="print" onload="this.media='all'">

<link href="/assets/css/style.css?2144895478" rel="stylesheet" type="text/css" />

                <meta property="og:title" content="Why Class Constants Should be Typed" />
        <meta property="og:url" content="https://tomasvotruba.com/blog/2020/06/22/why-class-constants-should-be-typed" />
        <meta name="description" property="og:description" content="Do you use PHP 7.4 [typed properties](/blog/2018/11/15/how-to-get-php-74-typed-properties-to-your-code-in-few-seconds/)? Do you know why?


I use them, so **I don&#039;t have to think and validate the property type** every time. We just know its type or PHP would crash otherwise.


Until PHP 7.4 this was not possible and code was kinda crappy.
Where are we now with constant type? Do you trust your class constants type?
" />

                    <meta property="og:image" content="https://tomasvotruba.com/assets/images/posts/2020/typed_constants.png" />
            <meta name="twitter:card" content="summary_large_image"/>
            </head>

    <body>
        <!-- post_id: 264 -->
        <div id="menu">
    <div class="container-fluid">
        <a href="/">Home</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/blog">Blog</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/book/the-power-of-automated-refactoring">Book</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/trainings">Trainings</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/contact">Contact</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/about-me">About Me</a>
        <span class="pl-2 pr-2">•</span>

        <a href="https://twitter.com/votrubaT" target="blank">Twitter</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/rss.xml" target="blank">RSS</a>
    </div>
</div>

        <div class="container-fluid post" id="content">
            <div class="text-center book-banner">
                <a href="https://leanpub.com/rector-the-power-of-automated-refactoring" target="blank" class="text-center">
                    <img src="/assets/images/banner-rector-book.png" class="mb-2 ml-auto mr-auto rounded " style="max-height: 5em" alt="">
                </a>
            </div>

            <h1>Why Class&nbsp;Constants Should&nbsp;be&nbsp;Typed</h1>

            <div class="pull-right">
                <a href="https://github.com/tomasvotruba/tomasvotruba.com/edit/main/packages/blog/data/2020/2020-06-22-why-class-constants-should-be-typed.md">Found a typo? Edit me</a>
            </div>

            <time datetime="2020-06-Mon" class="text-muted">
                2020-06-22
            </time>

            
            
            <div class="card card-bigger mb-5">
                <div class="card-body pb-2">
                    <p>Do you use PHP 7.4 <a href="/blog/2018/11/15/how-to-get-php-74-typed-properties-to-your-code-in-few-seconds/">typed properties</a>? Do you know why?
<br>
<br>
I use them, so <strong>I don't have to think and validate the property type</strong> every time. We just know its type or PHP would crash otherwise.
<br>
<br>
Until PHP 7.4 this was not possible and code was kinda crappy.
Where are we now with constant type? Do you trust your class constants type?</p>
                </div>
            </div>

            <p>With typed properties, the incorrect type-bug was completely removed:</p>
<pre><code class="language-php">&lt;?php

declare(strict_types=1);

final class Person
{
    public string $name;

    public function __construct(string $name)
    {
        $this-&gt;name = $name;
    }
}</code></pre>
<pre><code class="language-php">$name = new Person(20_20);</code></pre>
<p>You would not use the <code>Name</code> object like this, right?</p>
<p><br></p>
<h2 id="What-About-Constants">What About Constants?</h2>
<p><strong>What</strong> are constants? They hold value, like properties, but <strong>the value doesn't change</strong>. We can change the value in the code, but not during runtime.</p>
<p><em>Pro-tip: Do you think all your properties have values that can change? <a href="https://github.com/rectorphp/rector/blob/master/docs/rector_rules_overview.md#changereadonlypropertywithdefaultvaluetoconstantrector">Dare Rector to find them</a>.</em></p>
<p>How do you define a class constant?</p>
<pre><code class="language-php">&lt;?php

final class SomeClass
{
    private const ORDER = 'first';

    // ...
}</code></pre>
<p>How is this dangerous? Sometimes, in 2 years future from today, there will be pull-request that changes it like this:</p>
<pre><code class="language-php">&lt;?php

final class SomeClass
{
    private const ORDER = 1;
}</code></pre>
<p>Because if you're first, you're 1, right? I had the pleasure to debug such cases only to figure out the constant type was changed. Why? Because it could.</p>
<p><strong>Constants value can be changed manually - so their type.</strong> It's rarely desired behavior, moreover, when using these constants in 3rd party code or from one.</p>
<h2 id="How-Can-We-Prevent-Constant-Re-type">How Can We Prevent Constant Re-type?</h2>
<pre><code class="language-php">&lt;?php

final class SomeClass
{
    /**
     * Should be a string
     */
    private const ORDER = 'first';
}</code></pre>
<p>We read comments, READMEs, or manuals... only when something goes wrong.</p>
<pre><code class="language-php">&lt;?php

final class SomeClass
{
    /**
     * @var string
     */
    private const ORDER = 'first';
}</code></pre>
<p>Slightly better, but still no way to enforce it.</p>
<pre><code class="language-php">&lt;?php

final class SomeClass
{
    private string const ORDER = 'first';
}</code></pre>
<p>Great! But maybe in 2025?</p>
<h2 id="Future-Scoping">Future Scoping</h2>
<p>The <a href="https://stitcher.io/blog/new-in-php-8">PHP 8.0 release will be a blast</a>. It's already ~30 merged features, and feature freeze is still <a href="https://thephp.website/en/issue/php8-release-schedule">23 days ahead of us</a>.</p>
<p>If we look at selected features in PHP 8:</p>
<ul>
<li><a href="https://wiki.php.net/rfc/constructor_promotion">Constructor Property Promotion</a></li>
<li><a href="https://wiki.php.net/rfc/union_types_v2">Union Types 2.0</a></li>
<li><a href="https://wiki.php.net/rfc/mixed_type_v2">Mixed Type v2</a></li>
<li><a href="https://wiki.php.net/rfc/static_return_type">Static return type</a></li>
<li><a href="https://wiki.php.net/rfc/magic-methods-signature">Ensure correct signatures of magic methods</a></li>
<li><a href="https://wiki.php.net/rfc/make_ctor_ret_void">Make constructors and destructors return void</a> (WIP)</li>
</ul>
<p>We can see there is a handful of changes <strong>towards more strict and reliable types</strong>. We are moving from docblocks to in-code types.</p>
<p><strong>We can expect</strong> similar future for constants. Maybe even sooner before <code>TypedArrays[]</code> will be added.</p>
<p><strong>In 2015, we wished for typed properties, and in 2020 we have union strictly typed properties</strong>. We can go for typed constants now.</p>
<blockquote class="blockquote text-center mt-5 mb-5">
Check trends to predict code syntax,<br>
and write future compatible code your children will thank you for.
</blockquote>
<p><br></p>
<h2 id="Let-Computer-work-For-You">Let Computer work For You</h2>
<p><a href="/blog/2020/01/13/why-is-first-instant-feedback-crucial-to-developers/">The sooner you discover the error</a>, the better.</p>
<p>Do you use continuous integration (Github Actions, Gitlab CI, Travis CI...) and PHPStan? Add <a href="https://github.com/symplify/coding-standard#constant-type-must-match-its-value">PHPStan rule that checks <code>@var</code> definition vs the real value</a>.</p>
<pre><code class="language-diff"> &lt;?php

 final class SomeClass
 {
     /**
      * @var string
      */
-    private const ORDER = 'first';
+    private const ORDER = 1;
 }</code></pre>
<p>If this change occurs in pull-request, the CI will tell you it's not consistent with the <code>@var</code> type.</p>
<p>This way, you'll be <strong>aware of the type change right before the merge</strong>, which is much better than 2 years later after 4 hours of debugging. Trust me.</p>
<p><br></p>
<p>Happy coding!</p>

            <br>


            <div class="card mt-5 border-warning">
                <div class="card-body text-center mt-2">
                    <p>
                        Have you find this post useful? <strong>Do you want more?</strong>
                    </p>
                    <p>
                        Follow me on <a href="https://twitter.com/votrubaT">Twitter</a>, <a href="/rss.xml">RSS</a> or support me on <a href="https://github.com/sponsors/TomasVotruba">GitHub Sponsors</a>.
                    </p>
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-body text-white bg-success text-center">
                                            <a href="/blog/2020/06/15/how-to-create-monorepo-from-existing-repositories-in-7-steps" class="d-block">
                            <div>
                                Read next → <strong>How to create a Monorepo from Existing Repositories in 7 Steps</strong>
                            </div>
                        </a>
                                    </div>
            </div>

            <br>
            <br>

            <a name="comments"></a>
            <div id="disqus_thread"></div>

<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
    /*
    var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = 'https://itsworthsharing.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
        </div>

        <script id="dsq-count-scr" src="https://itsworthsharing.disqus.com/count.js" async defer></script>

        <link href="/assets/prism/prism.css" rel="stylesheet" type="text/css" />
        <script src="/assets/prism/prism.js"></script>

        <script>
    ga=function(){ ga.q.push(arguments) };
    ga.q=[];
    ga.l=+new Date;
    ga('create', 'UA-46082345-1', 'auto');
    ga('send','pageview');
</script>
<script src="https://www.google-analytics.com/analytics.js" async defer></script>

        <script type="text/javascript">
            // @see https://stackoverflow.com/a/30776817/1348344
            var date = new Date();
            // display every 2nd hour, not to spam users
            if (date.getHours() % 2 === 1) {
                document.querySelector('.book-banner').style.display = 'visible';
            } else {
                document.querySelector('.book-banner').style.display = 'none';
            }
        </script>
    </body>
</html>
