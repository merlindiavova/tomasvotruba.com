<!DOCTYPE html>
<html lang="en">
    <head>
        <title>How to Upgrade to Symplify 8 - From Fixers to Rector Rules | Tomas Votruba</title>
<meta charset="utf-8">
<meta name="robots" content="index, follow">

<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">

<meta name="twitter:card" content="summary"/>
<meta name="twitter:creator" content="@votrubaT"/>

    <meta property="og:title" content="How to Upgrade to Symplify 8 - From Fixers to Rector Rules" />
    <meta property="og:url" content="https://tomasvotruba.com/blog/2020/05/11/how-to-upgrade-to-symplify-8-from-fixers-to-rector-rules" />

            <meta property="og:image" content="/assets/images/tomas_votruba.jpg"/>
        <meta name="twitter:image" content="/assets/images/tomas_votruba.jpg"/>
    
<link rel="alternate" type="application/rss+xml" title="Tomas Votruba Blog RSS" href="/rss.xml">


<link rel="stylesheet" rel="preload" as="style" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:700&amp;display=swap" />

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous" media="print" onload="this.media='all'">

<link href="/assets/css/style.css?568729900" rel="stylesheet" type="text/css" />

                <meta name="description" property="og:description" content="Symplify 8 is going to be released in the 2nd half of May. But as in Symfony, you can get ready for future version today.

[In the previous post we upgraded Coding Standard from Sniffs to PHPStan](/blog/2020/05/04/how-to-upgrade-to-symplify-8-from-sniffs-to-phpstan-rules/). Today we finish with 2nd half - **from Fixers to Rector rules**.
" />
    </head>

    <body>
        <!-- post_id: 251 -->
        <div id="menu">
    <div class="container-fluid">
        <a href="/">Home</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/blog">Blog</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/book/the-power-of-automated-refactoring">Book</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/trainings">Trainings</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/contact">Contact</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/about-me">About Me</a>
        <span class="pl-2 pr-2">•</span>

        <a href="https://twitter.com/votrubaT" target="blank">Twitter</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/rss.xml" target="blank">RSS</a>
    </div>
</div>

        <div class="container-fluid post" id="content">
            <div class="text-center book-banner">
                <a href="https://leanpub.com/rector-the-power-of-automated-refactoring" target="blank" class="text-center">
                    <img src="/assets/images/banner-rector-book.png" class="mb-2 ml-auto mr-auto rounded " style="max-height: 5em" alt="">
                </a>
            </div>

            <h1>How to Upgrade to Symplify 8 - From Fixers to Rector Rules</h1>

            <div class="pull-right">
                <a href="https://github.com/tomasvotruba/tomasvotruba.com/edit/main/packages/blog/data/2020/2020-05-11-how-to-upgrade-to-symplify-8-from-fixers-to-rector-rules.md">Found a typo? Edit me</a>
            </div>

            <time datetime="2020-05-Mon" class="text-muted">
                2020-05-11
            </time>

            
                            <div class="card border-success mt-4">
                    <div class="card-header text-white bg-success">
                        This post was updated at December 2021 with fresh know-how.
                        <br>
                        <strong>What is new?</strong>
                    </div>
                                            <div class="card-body pb-2">
                            <p>Updated Rector/ECS YAML to PHP configuration, as current standard.
The method order by interface Rector rule is removed now.</p>
                        </div>
                                    </div>

                <br>
            
            <div class="card card-bigger mb-5">
                <div class="card-body pb-2">
                    <p>Symplify 8 is going to be released in the 2nd half of May. But as in Symfony, you can get ready for future version today.
<br><br>
<a href="/blog/2020/05/04/how-to-upgrade-to-symplify-8-from-sniffs-to-phpstan-rules/">In the previous post we upgraded Coding Standard from Sniffs to PHPStan</a>. Today we finish with 2nd half - <strong>from Fixers to Rector rules</strong>.</p>
                </div>
            </div>

            <p>When you run <a href="https://github.com/symplify/easy-coding-standard">ECS</a> with version 7.3+:</p>
<pre><code class="language-bash">vendor/bin/ecs check</code></pre>
<p>You might see such notices right before your code gets checked:</p>
<pre><code class="language-bash">PHP Notice:  Fixer "..." is deprecated. Use "..." instead</code></pre>
<h2 id="Why-were-These-Fixers-Dropped">Why were These Fixers Dropped?</h2>
<p>You'll find answer to this question <a href="/blog/2020/05/04/how-to-upgrade-to-symplify-8-from-sniffs-to-phpstan-rules/">in previous post</a>. To extend answer specifically for this post: Fixer and Rector do the same job - <strong>they change code based on specific recipe</strong>.</p>
<p><div class="card ml-4 mt-4 border-warning float-right post-snippet" style="width: 14em">
    <div class="card-body">
        Would you like to <strong>learn more about Rector</strong>? Step by step, from zero to hero?
        <br>

        <div class="text-center">
            <a href="/book/the-power-of-automated-refactoring/">
                <img src="/assets/images/rector_book.png" class="mb-3 mt-3 shadow">
                Get our new book
            </a>
        </div>
    </div>
</div>
</p>
<h3 id="What-is-the-Difference">What is the Difference?</h3>
<ul>
<li>Fixer works with <a href="https://www.php.net/manual/en/function.token-get-all.php">tokens</a> → which is <strong>great for spaces and <code>{}()</code> positions</strong> etc.,</li>
<li>Rector works with abstract syntax tree → <strong>great for refactoring, method/property position changes</strong>, rename across the code base, etc.</li>
</ul>
<p>Now we know <em>why</em>. Let's look <em>how</em> to deal with that.</p>
<h2 id="What-to-do-With-These-Deprecations">What to do With These Deprecations?</h2>
<p>So what does it mean? Remove all the rules from <code>ecs.php</code> and let go?</p>
<p>No, <strong>all you need to do is switch to Rector rules</strong>. It's better working and more reliable since it works with context and not token positions. So at first, you might see new changes in your code.</p>
<h2 id="How-to-Handle-Upgrade-in-30-minutes">How to Handle Upgrade in 30 minutes?</h2>
<p>There are dozen deprecated fixers in total. Let's take it one by one.</p>
<p>First - if you don't have Rector, install it:</p>
<pre><code class="language-bash">composer require rector/rector --dev</code></pre>
<h2 id="1-No-Empty-Doc-Block">1. No Empty Doc Block</h2>
<p>The <code>RemoveEmptyDocBlockFixer</code> rule basically copied behavior of native <code>NoEmptyPhpdocFixer</code>, so just it instead:</p>
<pre><code class="language-diff"> &lt;?php

 // ecs.php

 declare(strict_types=1);

 use Symfony\Component\DependencyInjection\Loader\Configurator\ContainerConfigurator;

 return function (ContainerConfigurator $containerConfigurator): void {
     $services = $containerConfigurator-&gt;services();
-    $services-&gt;set(Symplify\CodingStandard\Fixer\Commenting\RemoveEmptyDocBlockFixer::class);
+    $services-&gt;set(PhpCsFixer\Fixer\Phpdoc\NoEmptyPhpdocFixer::class);
 };</code></pre>
<h2 id="2-Preg-Delimiter-Character">2. Preg Delimiter Character</h2>
<p>The <code>PregDelimiterFixer</code> was checking consistent preg delimiter, in this case <code>#</code>:</p>
<pre><code class="language-diff"> class SomeClass
 {
     public function run()
     {
-        preg_match('~value~', $value);
+        preg_match('#value#', $value);
     }
 }</code></pre>
<p>Instead of <del><code>PhpCsFixer\Fixer\ControlStructure\PregDelimiterFixer</code></del> fixer:</p>
<p>↓</p>
<p>use Rector rule:</p>
<pre><code class="language-php">use Rector\CodingStyle\Rector\FuncCall\ConsistentPregDelimiterRector;
use Rector\Config\RectorConfig;

return function (RectorConfig $rectorConfig): void {
    $rectorConfig-&gt;set(ConsistentPregDelimiterRector::class)
        // default
        -&gt;arg('delimiter', '#');
};</code></pre>
<h2 id="3-Required-Must-be-followed-by-Absolute-Path">3. Required Must be followed by Absolute Path</h2>
<pre><code class="language-diff"> class SomeClass
 {
     public function run()
     {
-        require 'autoload.php';
+        require __DIR__ . '/autoload.php';
     }
 }</code></pre>
<p>Instead of <del><code>PhpCsFixer\Fixer\ControlStructure\RequireFollowedByAbsolutePathFixer</code></del> fixer,</p>
<p>↓</p>
<p>use Rector rule:</p>
<pre><code class="language-php">use Rector\CodingStyle\Rector\Include_\FollowRequireByDirRector;
use Rector\Config\RectorConfig;

return function (RectorConfig $rectorConfig): void {
    $rectorConfig-&gt;rule(FollowRequireByDirRector::class);
};</code></pre>
<h2 id="4-Match-Exception-variable-name-to-its-Type">4. Match Exception variable name to its Type</h2>
<pre><code class="language-diff"> class SomeClass
 {
     public function run()
     {
         try {
             // ...
-        } catch (SomeException $typoException) {
-            $typoException-&gt;getMessage();
+        } catch (SomeException $someException) {
+            $someException-&gt;getMessage();
         }
     }
 }</code></pre>
<p>Instead of <del><code>PhpCsFixer\Fixer\Naming\CatchExceptionNameMatchingTypeFixer</code></del> Fixer:</p>
<p>↓</p>
<p>use Rector rule:</p>
<pre><code class="language-php">use Rector\CodingStyle\Rector\Catch_\CatchExceptionNameMatchingTypeRector;
use Rector\Config\RectorConfig;

return function (RectorConfig $rectorConfig): void {
    $rectorConfig-&gt;rule(CatchExceptionNameMatchingTypeRector::class);
};</code></pre>
<h2 id="5-Match-Property-and-Variable-to-its-Type">5. Match Property and Variable to its Type</h2>
<pre><code class="language-diff"> class SomeClass
 {
     /**
      * @var EntityManager
      */
-    private $eventManager;
+    private $entityManager;
-    public function __construct(EntityManager $eventManager)
+    public function __construct(EntityManager $entityManager)
     {
-        $this-&gt;eventManager = $eventManager;
+        $this-&gt;entityManager = $entityManager;
     }
 }</code></pre>
<p>Instead of <del><code>Symplify\CodingStandard\Fixer\Naming\PropertyNameMatchingTypeFixer</code></del> Fixer</p>
<p>↓</p>
<p>use Rector rule:</p>
<pre><code class="language-php">use Rector\Naming\Rector\Class_\RenamePropertyToMatchTypeRector;
use Rector\Config\RectorConfig;

return function (RectorConfig $rectorConfig): void {
    $rectorConfig-&gt;set(RenamePropertyToMatchTypeRector::class);
};</code></pre>
<h2 id="6-Set-Default-Values-to-bool-and-array-Type-to-Prevent-Undefined-Value">6. Set Default Values to bool and array Type to Prevent Undefined Value</h2>
<pre><code class="language-diff"> class SomeClass
 {
     /**
      * @var bool
      */
-    private $isDisabled;
+    private $isDisabled = false;

     /**
      * @var int[]
      */
-    private $values;
+    private $values = [];

     public function isEmpty()
     {
         return $this-&gt;values === [];
     }
 }</code></pre>
<p>Instead of:</p>
<ul>
<li><del><code>Symplify\CodingStandard\Fixer\Property\BoolPropertyDefaultValueFixer</code></del></li>
<li><del><code>Symplify\CodingStandard\Fixer\Property\ArrayPropertyDefaultValueFixer</code></del></li>
</ul>
<p>↓</p>
<p>use Rector rules:</p>
<pre><code class="language-php">use Rector\CodingStyle\Rector\Class_\AddArrayDefaultToArrayPropertyRector;
use Rector\SOLID\Rector\Property\AddFalseDefaultToBoolPropertyRector;
use Rector\Config\RectorConfig;

return function (RectorConfig $rectorConfig): void {
    $rectorConfig-&gt;rule(AddFalseDefaultToBoolPropertyRector::class);
    $rectorConfig-&gt;rule(AddArrayDefaultToArrayPropertyRector::class);
};</code></pre>
<h2 id="7-Use-class-over-Strings-Names">7. Use <code>::class</code> over Strings Names</h2>
<p>This feature is here since PHP 5.5, and it's a massive help for static analysis and instant migrations.</p>
<pre><code class="language-diff"> class AnotherClass
 {
 }

 class SomeClass
 {
     public function run()
     {
-        return 'AnotherClass';
+        return \AnotherClass::class;
     }
 }</code></pre>
<p>Instead of <del><code>Symplify\CodingStandard\Fixer\Php\ClassStringToClassConstantFixer</code></del> Fixer:</p>
<p>↓</p>
<p>use Rector rule:</p>
<pre><code class="language-php">use Rector\Php55\Rector\String_\StringClassNameToClassConstantRector;
use Rector\Config\RectorConfig;

return function (RectorConfig $rectorConfig): void {
    $rectorConfig-&gt;rule(StringClassNameToClassConstantRector::class);
};</code></pre>
<h2 id="8-Order-Property-by-Complexity-Private-Methods-by-Use">8. Order Property by Complexity, Private Methods by Use</h2>
<p>How do you order your methods? Random?</p>
<p><strong>Be sure to read <a href="/blog/2018/11/01/how-teach-your-team-private-method-sorting-in-3-mins/">How to Teach Your Team Private Method Sorting in 3 mins</a>.</strong></p>
<p>Instead of:</p>
<ul>
<li><del><code>Symplify\CodingStandard\Fixer\Order\PrivateMethodOrderByUseFixer</code></del></li>
<li><del><code>Symplify\CodingStandard\Fixer\Order\PropertyOrderByComplexityFixer</code></del></li>
</ul>
<p>↓</p>
<p>use Rector rules:</p>
<pre><code class="language-php">use Rector\Order\Rector\Class_\OrderPrivateMethodsByUseRector;
use Rector\Order\Rector\Class_\OrderPropertyByComplexityRector;
use Rector\Config\RectorConfig;

return function (RectorConfig $rectorConfig): void {
    $rectorConfig-&gt;set(OrderPrivateMethodsByUseRector::class);
    $rectorConfig-&gt;set(OrderPropertyByComplexityRector::class);
};</code></pre>
<h2 id="9-Specific-Order-By-Parent-Contract">9. Specific Order By Parent Contract</h2>
<p>*Update: this rule was removed since Rector 0.9+ as not very useful in everyday coding.</p>
<h2 id="10-Make-Classes-final-if-You-Can">10. Make Classes <code>final</code>, if You Can</h2>
<p>This will be the biggest added value, as tokens have no idea if your class is extended by another class.</p>
<p>Rector knows that, so be ready for more solid code after you run it.</p>
<p>Instead of <del><code>Symplify\CodingStandard\Fixer\Solid\FinalInterfaceFixer</code></del> Fixer:</p>
<p>↓</p>
<p>use Rector rule:</p>
<pre><code class="language-php">use Rector\SOLID\Rector\Class_\FinalizeClassesWithoutChildrenRector;
use Rector\Config\RectorConfig;

return function (RectorConfig $rectorConfig): void {
    $rectorConfig-&gt;rule(FinalizeClassesWithoutChildrenRector::class);
};</code></pre>
<p><br></p>
<p>And that's it. Now you're ready!</p>
<p><br></p>
<p>Happy coding!</p>

            <br>


            <div class="card mt-5 border-warning">
                <div class="card-body text-center mt-2">
                    <p>
                        Have you find this post useful? <strong>Do you want more?</strong>
                    </p>
                    <p>
                        Follow me on <a href="https://twitter.com/votrubaT">Twitter</a>, <a href="/rss.xml">RSS</a> or support me on <a href="https://github.com/sponsors/TomasVotruba">GitHub Sponsors</a>.
                    </p>
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-body text-white bg-success text-center">
                                            <a href="/blog/2020/05/04/how-to-upgrade-to-symplify-8-from-sniffs-to-phpstan-rules" class="d-block">
                            <div>
                                Read next → <strong>How to Upgrade to Symplify 8 - From Sniffs to PHPStan Rules</strong>
                            </div>
                        </a>
                                    </div>
            </div>

            <br>
            <br>

            <a name="comments"></a>
            <div id="disqus_thread"></div>

<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
    /*
    var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = 'https://itsworthsharing.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
        </div>

        <script id="dsq-count-scr" src="https://itsworthsharing.disqus.com/count.js" async defer></script>

        <link href="/assets/prism/prism.css" rel="stylesheet" type="text/css" />
        <script src="/assets/prism/prism.js"></script>

        <script>
    ga=function(){ ga.q.push(arguments) };
    ga.q=[];
    ga.l=+new Date;
    ga('create', 'UA-46082345-1', 'auto');
    ga('send','pageview');
</script>
<script src="https://www.google-analytics.com/analytics.js" async defer></script>

        <script type="text/javascript">
            // @see https://stackoverflow.com/a/30776817/1348344
            var date = new Date();
            // display every 2nd hour, not to spam users
            if (date.getHours() % 2 === 1) {
                document.querySelector('.book-banner').style.display = 'visible';
            } else {
                document.querySelector('.book-banner').style.display = 'none';
            }
        </script>
    </body>
</html>
