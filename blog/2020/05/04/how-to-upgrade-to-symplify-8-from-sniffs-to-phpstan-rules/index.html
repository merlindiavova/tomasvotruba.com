<!DOCTYPE html>
<html lang="en">
    <head>
        <title>How to Upgrade to Symplify 8 - From Sniffs to PHPStan Rules | Tomas Votruba</title>
<meta charset="utf-8">
<meta name="robots" content="index, follow">

<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">

<meta name="twitter:card" content="summary"/>
<meta name="twitter:creator" content="@votrubaT"/>

<meta property="og:image" content="/assets/images/tomas_votruba.jpg"/>

<link rel="alternate" type="application/rss+xml" title="Tomas Votruba Blog RSS" href="/rss.xml">


<link rel="stylesheet" rel="preload" as="style" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:700&amp;display=swap" />

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous" media="print" onload="this.media='all'">

<link href="/assets/css/style.css?1381854270" rel="stylesheet" type="text/css" />

                <meta property="og:title" content="How to Upgrade to Symplify 8 - From Sniffs to PHPStan Rules" />
        <meta property="og:url" content="https://tomasvotruba.com/blog/2020/05/04/how-to-upgrade-to-symplify-8-from-sniffs-to-phpstan-rules" />
        <meta name="description" property="og:description" content="Since Symplify 7.3, you might notice a few deprecation notices in your coding standards. As Symplify 8 release is [synced with Symfony cycle](/blog/2017/10/30/what-can-you-learn-from-menstruation-and-symfony-releases/), both will be released at the end of May.


What to do with these deprecations? Why were these sniffs dropped? How to handle upgrades in 1 hour?
" />

            </head>

    <body>
                <!-- post_id: 250 -->
        <div id="menu">
    <div class="container-fluid">
        <a href="/">Home</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/blog">Blog</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/book/the-power-of-automated-refactoring">Book</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/trainings">Trainings</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/contact">Contact</a>
        <span class="pl-2 pr-2">•</span>

        <a href="https://twitter.com/votrubaT" target="blank">Twitter</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/rss.xml" target="blank">RSS</a>
    </div>
</div>

        <div class="container-fluid post" id="content">
            <h1>How to Upgrade to Symplify 8 - From Sniffs to PHPStan Rules</h1>

            <div class="pull-right">
                <a href="https://github.com/tomasvotruba/tomasvotruba.com/edit/main/packages/blog/data/2020/2020-05-04-how-to-upgrade-to-symplify-8-from-sniffs-to-phpstan-rules.md">Found a typo? Edit me</a>
            </div>

            <time datetime="2020-05-Mon" class="text-muted">
                2020-05-04
            </time>

            
                            <div class="card border-success mt-4">
                    <div class="card-header text-white bg-success">
                        This post was updated at August 2020 with fresh know-how.
                        <br>
                        <strong>What is new?</strong>
                    </div>
                                            <div class="card-body pb-2">
                            <p>Updated ECS YAML to PHP configuration since <strong>ECS 8</strong>.</p>
                        </div>
                                    </div>

                <br>
            
            <div class="card card-bigger mb-5">
                <div class="card-body pb-2">
                    <p>Since Symplify 7.3, you might notice a few deprecation notices in your coding standards. As Symplify 8 release is <a href="/blog/2017/10/30/what-can-you-learn-from-menstruation-and-symfony-releases/">synced with Symfony cycle</a>, both will be released at the end of May.
<br>
<br>
What to do with these deprecations? Why were these sniffs dropped? How to handle upgrades in 1 hour?</p>
                </div>
            </div>

            <p>When you run <a href="https://github.com/symplify/easy-coding-standard">ECS</a> with version 7.3+:</p>
<pre><code class="language-bash">vendor/bin/ecs check</code></pre>
<p>You might see such notices right before your code gets checked:</p>
<pre><code class="language-bash">PHP Notice:  Sniff "..." is deprecated. Use "..." instead</code></pre>
<h2 id="why-were-these-sniffs-dropped?">Why were These Sniffs Dropped?</h2>
<p>Symplify 7 used lots of sniffs based on coding standard <a href="https://www.php.net/manual/en/function.token-get-all.php">tokens</a>. In time they were made, they were as good. <a href="/blog/2018/10/25/why-ast-fixes-your-coding-standard-better-than-tokens/#shifting-the-scope">Tokens are best at spaces, abstract syntax tree is best at logical code structure</a>.</p>
<p>E.g. <code>TraitNameSniff</code> check name of traits and makes sure the name ends with &quot;Trait&quot;:</p>
<pre><code class="language-php">&lt;?php

// hey, this should be "ProductTrait"
trait Product
{
}</code></pre>
<p>Do you see any spaces or token positions? No, it's just:</p>
<ul>
<li>find a trait</li>
<li>check its name</li>
</ul>
<p>So writing this rule in tokens is the wrong tool chosen. Why? With tokens, you need to make sure:</p>
<ul>
<li>trait token is found</li>
<li>there are no spaces after trait token</li>
<li>detect the name</li>
<li>for other rules, resolve its fully qualified name based on the namespace and use imports (real hell with tokens)</li>
</ul>
<p>But <strong>why waste time on re-inventing the wheel</strong>, when we can use a tool that handles tedious work for us?
It's better to use <em>abstract syntax tree</em> technology, in this case <a href="https://phpstan.org">PHPStan</a>.</p>
<p><br></p>
<p><strong>That's why</strong> all the &quot;AST&quot; sniffs were migrated to PHPStan rules.</p>
<h2 id="what-to-do-with-these-deprecations?">What to do With These Deprecations?</h2>
<p>So what does it mean? Remove all the rules from <code>ecs.php</code> and let go?</p>
<p>No, <strong>all you need to do is switch to PHPStan rules</strong>. It's better working and more reliable since it works with context and not token positions. So at first, you might discover a few new reported errors here and there.</p>
<h2 id="how-to-handle-upgrade-in-1-hour?">How to Handle Upgrade in 1 hour?</h2>
<p>There are 14 deprecated sniffs in total. Don't worry, while it might seem like a considerable number, the replacement is a matter of an hour.</p>
<p>Have you used a full Symplify set?</p>
<pre><code class="language-php">
// ecs.php
use Symfony\Component\DependencyInjection\Loader\Configurator\ContainerConfigurator;
use Symplify\EasyCodingStandard\ValueObject\Set\SetList;

return function (ContainerConfigurator $containerConfigurator): void {
    $containerConfigurator-&gt;import(SetList::SYMPLIFY);
};</code></pre>
<p>Then you won't see any deprecations, because rules were removed from the config for you.
Still, I recommend adding these rules to <code>phpstan.neon</code>.</p>
<h2 id="1.-abstract,-trait-and-interface-naming-sniffs">1. Abstract, Trait and Interface Naming Sniffs</h2>
<p>These rules were removed:</p>
<ul>
<li><del><code>Symplify\CodingStandard\Sniffs\Naming\AbstractClassNameSniff</code></del></li>
<li><del><code>Symplify\CodingStandard\Sniffs\Naming\TraitNameSniff</code></del></li>
<li><del><code>Symplify\CodingStandard\Sniffs\Naming\InterfaceNameSniff</code></del></li>
</ul>
<p>and replaced by:</p>
<p>↓</p>
<pre><code class="language-bash">composer require --dev slam/phpstan-extensions</code></pre>
<pre><code class="language-yaml"># phpstan.neon
rules:
    - SlamPhpStan\ClassNotationRule</code></pre>
<h2 id="2.-cognitive-complexity">2. Cognitive Complexity</h2>
<p>The <a href="/blog/2018/05/21/is-your-code-readable-by-humans-cognitive-complexity-tells-you/">only <del>sniff</del> rule your coding standard should have</a>... just got better.</p>
<p>The orifinal sniffs were removed:</p>
<ul>
<li><del><code>Symplify\CodingStandard\Sniffs\CleanCode\CognitiveComplexitySniff</code></del></li>
<li><del><code>Symplify\CodingStandard\Sniffs\CleanCode\ClassCognitiveComplexitySniff</code></del></li>
</ul>
<p>and replaced by more avanced AST in form of PHPStan rules:</p>
<p>↓</p>
<pre><code class="language-yaml"># phpstan.neon
includes:
    - vendor/symplify/coding-standard/packages/cognitive-complexity/config/cognitive-complexity-rules.neon

# if you use default value, you can skip this section
parameters:
    symplify:
        max_cognitive_complexity: 10
        max_class_cognitive_complexity: 60</code></pre>
<h2 id="3.-make-sure-classes-used-in-@param,-@var-and-@return-exists">3. Make sure Classes used in @param, @var and @return Exists</h2>
<ul>
<li><del><code>Symplify\CodingStandard\Sniffs\Commenting\AnnotationTypeExistsSniff</code></del></li>
</ul>
<p>Just drop it. PHPStan level 0 handles this.</p>
<h2 id="4.-forbidden-static-→-explicit-static">4. Forbidden Static → Explicit Static</h2>
<p>Static functions <a href="/blog/2019/04/01/removing-static-there-and-back-again/">are best way to slowly create technical dept</a>. But sometimes it's tough to code without them.</p>
<p>So instead of forbidding them:</p>
<ul>
<li><del><code>Symplify\CodingStandard\Sniffs\CleanCode\ForbiddenStaticFunctionSniff</code></del></li>
</ul>
<p>↓</p>
<p>Just be honest about them:</p>
<pre><code class="language-yaml"># phpstan.neon
rules:
    - Symplify\CodingStandard\Rules\NoClassWithStaticMethodWithoutStaticNameRule</code></pre>
<p>The same way you see a &quot;trait&quot; in a file name and know it's a trait,
this rule makes sure that classes with static methods have &quot;static&quot; in its name.</p>
<p>I've been using it for 4 days, and oh, what a shame I feel when I want to use a &quot;Static&quot; &quot;service&quot;. It <strong>makes me think twice both about the design and consequences</strong>.</p>
<h2 id="5.-forbidden-parent-class">5. Forbidden Parent Class</h2>
<p>Even though it's repeated over, again and again, that composition beats inheritance, the PHP code I see is full of it.</p>
<p>Sometimes the only way to <a href="/blog/2017/10/16/how-to-use-repository-with-doctrine-as-service-in-symfony/">promote so-far-the-best practise</a>, is to enforce it.</p>
<ul>
<li><del><code>Symplify\CodingStandard\Sniffs\CleanCode\ForbiddenParentClassSniff</code></del></li>
</ul>
<p>↓</p>
<pre><code class="language-yaml"># phpstan.neon
rules:
    - Symplify\CodingStandard\Rules\ForbiddenParentClassRule

parameters:
    symplify:
        forbidden_parent_classes:
            - 'Doctrine\ORM\EntityRepository'</code></pre>
<h2 id="6.-use-custom-exceptions-over-basic-ones">6. Use Custom Exceptions over Basic Ones</h2>
<ul>
<li><del><code>Symplify\CodingStandard\Sniffs\Architecture\ExplicitExceptionSniff</code></del></li>
</ul>
<p>↓</p>
<pre><code class="language-yaml"># phpstan.neon
rules:
    - Symplify\CodingStandard\Rules\NoDefaultExceptionRule</code></pre>
<h2 id="7.-prefer-one-class-over-another">7. Prefer One Class over Another</h2>
<ul>
<li><del><code>Symplify\CodingStandard\Sniffs\Architecture\PreferredClassSniff</code></del></li>
</ul>
<p>↓</p>
<pre><code class="language-yaml"># phpstan.neon
parameters:
    symplify:
        old_to_preffered_classes:
            DateTime: 'Nette\Utils\DateTime'

rules:
    - Symplify\CodingStandard\Rules\PreferredClassRule</code></pre>
<h2 id="8.-no-duplicated-short-classes">8. No Duplicated Short Classes</h2>
<ul>
<li><del><code>Symplify\CodingStandard\Sniffs\Architecture\DuplicatedClassShortNameSniff</code></del></li>
</ul>
<p>↓</p>
<pre><code class="language-yaml"># phpstan.neon
rules:
    - Symplify\CodingStandard\Rules\NoDuplicatedShortClassNameRule</code></pre>
<h2 id="9.-use-explicit-return-over-&amp;-reference">9. Use explicit Return over <code>&amp;</code> Reference</h2>
<ul>
<li><del><code>Symplify\CodingStandard\Sniffs\CleanCode\ForbiddenReferenceSniff</code></del></li>
</ul>
<p>↓</p>
<pre><code class="language-yaml"># phpstan.neon
rules:
    - Symplify\CodingStandard\Rules\NoReferenceRule</code></pre>
<h2 id="10.-dont-leave-dump()-function-in-the-code">10. Don't leave <code>dump()</code> Function in the Code</h2>
<ul>
<li><del><code>Symplify\CodingStandard\Sniffs\Debug\DebugFunctionCallSniff</code></del></li>
</ul>
<p>↓</p>
<pre><code class="language-yaml"># phpstan.neon
rules:
    - Symplify\CodingStandard\Rules\NoDebugFuncCallRule</code></pre>
<h2 id="11.-respect-naming-of-your-parents">11. Respect Naming of Your Parents</h2>
<ul>
<li><del><code>Symplify\CodingStandard\Sniffs\Naming\ClassNameSuffixByParentSniff</code></del></li>
</ul>
<p>↓</p>
<pre><code class="language-yaml"># phpstan.neon
rules:
    - Symplify\CodingStandard\Rules\ClassNameRespectsParentSuffixRule

parameters:
    symplify:
        parent_classes:
            - Rector</code></pre>
<p>And that's it! You've just migrated all deprecated sniffs to PHPStan rules. Upgrade to Symplify 8 will be a piece of cake for you.</p>
<p><br></p>
<p><a href="/blog/2020/05/11/how-to-upgrade-to-symplify-8-from-fixers-to-rector-rules/">In the next post, we'll look on the 2nd half</a> - <strong>how to migrate fixers into Rector rules</strong>.</p>
<p><br></p>
<p>Happy coding!</p>

            <br>


            <div class="card mt-5 border-warning">
                <div class="card-body text-center mt-2">
                    <p>
                        Have you find this post useful? <strong>Do you want more?</strong>
                    </p>
                    <p>
                        Follow me on <a href="https://twitter.com/votrubaT">Twitter</a>, <a href="/rss.xml">RSS</a> or support me on <a href="https://github.com/sponsors/TomasVotruba">GitHub Sponsors</a>.
                    </p>
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-body text-white bg-success text-center">
                    
                                            <a href="/blog/2020/04/27/forget-complex-migrations-use-cleaning-lady-checklist" class="d-block">
                            <div>
                                Read next → <strong>Forget Complex Migrations, Use Cleaning Lady Checklist</strong>
                            </div>
                        </a>
                                    </div>
            </div>

            <br>
            <br>

            <a name="comments"></a>
            <div id="disqus_thread"></div>

<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
    /*
    var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = 'https://itsworthsharing.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
        </div>

        <script id="dsq-count-scr" src="https://itsworthsharing.disqus.com/count.js" async defer></script>

        <link href="/assets/prism/prism.css" rel="stylesheet" type="text/css" />
        <script src="/assets/prism/prism.js"></script>

        <script>
    ga=function(){ ga.q.push(arguments) };
    ga.q=[];
    ga.l=+new Date;
    ga('create', 'UA-46082345-1', 'auto');
    ga('send','pageview');
</script>
<script src="https://www.google-analytics.com/analytics.js" async defer></script>
    </body>
</html>
