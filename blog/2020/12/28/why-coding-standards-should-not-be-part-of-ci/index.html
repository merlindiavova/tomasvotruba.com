<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Why Coding Standards Should Not Be Part of CI | Tomas Votruba</title>
<meta charset="utf-8">
<meta name="robots" content="index, follow">

<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">

<meta name="twitter:card" content="summary"/>
<meta name="twitter:creator" content="@votrubaT"/>

    <meta property="og:title" content="Why Coding Standards Should Not Be Part of CI" />
    <meta property="og:url" content="https://tomasvotruba.com/blog/2020/12/28/why-coding-standards-should-not-be-part-of-ci" />

            <meta property="og:image" content="/assets/images/tomas_votruba.jpg"/>
        <meta name="twitter:image" content="/assets/images/tomas_votruba.jpg"/>
    
<link rel="alternate" type="application/rss+xml" title="Tomas Votruba Blog RSS" href="/rss.xml">


<link rel="stylesheet" rel="preload" as="style" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:700&amp;display=swap" />

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous" media="print" onload="this.media='all'">

<link href="/assets/css/style.css?1589121445" rel="stylesheet" type="text/css" />

                <meta name="description" property="og:description" content="Why do you use coding standards? To standardize the design of your code so that any contributor will produce somewhat similar PHP code.

Where do we use it? In CI pipelines on every pull-request, locally in a command line or within PHPStorm.
**Now take these 3 places and drop coding standard from them.**
" />
    </head>

    <body>
        <!-- post_id: 295 -->
        <div id="menu">
    <div class="container-fluid">
        <a href="/">Home</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/blog">Blog</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/book/the-power-of-automated-refactoring">Book</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/trainings">Trainings</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/contact">Contact</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/about-me">About Me</a>
        <span class="pl-2 pr-2">•</span>

        <a href="https://twitter.com/votrubaT" target="blank">Twitter</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/rss.xml" target="blank">RSS</a>
    </div>
</div>

        <div class="container-fluid post" id="content">
            <div class="text-center book-banner">
                <a href="https://leanpub.com/rector-the-power-of-automated-refactoring" target="blank" class="text-center">
                    <img src="/assets/images/banner-rector-book.png" class="mb-2 ml-auto mr-auto rounded " style="max-height: 5em" alt="">
                </a>
            </div>

            <h1>Why Coding Standards Should Not Be Part of CI</h1>

            <div class="pull-right">
                <a href="https://github.com/tomasvotruba/tomasvotruba.com/edit/main/packages/blog/data/2020/2020-12-28-why-coding-standards-should-not-be-part-of-ci.md">Found a typo? Edit me</a>
            </div>

            <time datetime="2020-12-Mon" class="text-muted">
                2020-12-28
            </time>

            
            
            <div class="card card-bigger mb-5">
                <div class="card-body pb-2">
                    <p>Why do you use coding standards? To standardize the design of your code so that any contributor will produce somewhat similar PHP code.
<br><br>
Where do we use it? In CI pipelines on every pull-request, locally in a command line or within PHPStorm.
<strong>Now take these 3 places and drop coding standard from them.</strong></p>
                </div>
            </div>

            <p>&quot;What?&quot; Wait a sec. We'll get to that.</p>
<p>Do you use using PHPStorm plugins for coding standards? I <a href="/blog/2019/06/24/do-you-use-php-codesniffer-and-php-cs-fixer-phpstorm-plugin-you-are-slow-and-expensive/">argued it's a waste of time</a> and that you should move to CI. In recent months, I conclude <strong>that even coding standard in CI is rather limiting for daily work</strong>. We have to wait for CI feedback, process the feedback, and pay for CI work-minutes.</p>
<p>I believe we can get rid of this technical debt. Why even care? <a href="/blog/2020/01/13/why-is-first-instant-feedback-crucial-to-developers/">Because faster CI feedback is</a>, the addictive is coding against it. We'll get to that.</p>
<p><br></p>
<p>What do we talk about when we say &quot;coding standards&quot;?</p>
<h2 id="1-Coding-Standard-is-about-How-Code-Looks">1. Coding Standard is about How Code Looks</h2>
<p>If we run coding standard on our code, the only thing that should change is <strong>its design</strong>:</p>
<pre><code class="language-diff">-   class    SomeClass { }
+class SomeClass
+{
+}</code></pre>
<p>Their features and logic should remain the same.</p>
<ul>
<li>Does your coding standard handle refactoring or upgrades? It should be by <a href="https://github.com/rectorphp/rector">Rector</a>.</li>
<li>Does your coding standard tell you that <code>dump()</code> was left in the code? <a href="https://github.com/phpstan/phpstan">PHPStan</a> should handle that.</li>
</ul>
<h2 id="2-Coding-Standard-is-Deterministic">2. Coding Standard is Deterministic</h2>
<p><strong>Deterministic means that each input has exactly one output</strong>.</p>
<p>E.g., you have a car. If you turn its steering wheel to the left, the car will turn left. If you turn it right, the car will turn right.</p>
<img src="/assets/images/posts/2020/steering-wheel.jpg" class="img-thumbnail">
<p>If turning the steering wheel in one direction does not produce the same output in the same conditions, we know that car is broken, or we're too drunk. We should stop driving in both cases as it can have non-deterministic consequences.</p>
<p>The same applies to coding standards. If we say A → we must add B.</p>
<ul>
<li>We don't use composed constants → we use each on their standalone line.</li>
</ul>
<pre><code class="language-diff">-const ONE = 'two', TWO = 'one';
+const ONE = 'two';
+const TWO = 'one';</code></pre>
<ul>
<li>We don't use old arrays → we use new ones.</li>
</ul>
<pre><code class="language-diff">-$items = array(
+$items = [
     // ...
-);
+];</code></pre>
<p>We can't say: &quot;we don't use old arrays → we use anything else&quot;. That's not a coding standard but an unfinished opinion.</p>
<h2 id="3-Coding-Standard-Rules-must-be-Fixable">3. Coding Standard Rules must be Fixable</h2>
<p>Let's get back to the car. The steering wheel is deterministic. Turn it left →  car turns left, turn it right → car turns right. If we turn left and turns right, we know the car paradigm is broken and take it into the car repair shop. They already know how the car should behave without us telling them. They know <strong>how to fix it</strong>, no need to discuss car standards.</p>
<p>Same applies for coding standard:</p>
<pre><code class="language-diff">-$items = array(
+$items = [
     // ...
-);
+];</code></pre>
<p>That's why every coding standard rule <strong>should be fixable by default</strong>. Actually, <a href="https://github.com/FriendsOfPHP/PHP-CS-Fixer">PHP CS Fixer</a> is built on this premise, and each rule is a fixer by default. Good job!</p>
<p>If it's impossible to come up with a fixable version, a PHPStan rule should handle this case.</p>
<p><br></p>
<p>What happens if we apply points 1, 2, and 3 to our coding standard set? It handles code design, it is deterministic, and it is fixable. That looks like work for robots...</p>
<h2 id="Why-do-we-put-Coding-Standards-into-CI">Why do we put Coding Standards into CI?</h2>
<p>Well, one reason is self-evident - <em>status quo</em>, we're used to that.</p>
<p>Also, we want the code to look the same on every merge. Apart from that, there is not much to say.</p>
<h2 id="How-Coding-Standard-in-CI-Wastes-Time">How Coding Standard in CI Wastes Time?</h2>
<p>If we have a project with 15 pull-request a day and coding standard run in CI for every pull-request, that's at least 15 runs a day.
One run can take 3 mins on average. That's 45 minutes. What happens when a coding standard fails? We have to check it manually, fix it, and push the commit into the branch.</p>
<p>The circle repeats. That's <strong>at least 90 minutes of waiting time wasted a day for your whole team</strong>. Also, now robots are controlling humans. Our CI is adding extra work to developers, and developers must silently obey to make CI robots happy. Dooms Day already?</p>
<p><br></p>
<p>Let's get back to the primary purpose of coding standards. Our PHP code should look the same.</p>
<p>Could you think of a better solution that does not waste 90 minutes a day and turn us into slaves but keeps our PHP code looks nice and pretty?</p>
<p><br></p>
<p>Happy coding!</p>

            <br>


            <div class="card mt-5 border-warning">
                <div class="card-body text-center mt-2">
                    <p>
                        Have you find this post useful? <strong>Do you want more?</strong>
                    </p>
                    <p>
                        Follow me on <a href="https://twitter.com/votrubaT">Twitter</a>, <a href="/rss.xml">RSS</a> or support me on <a href="https://github.com/sponsors/TomasVotruba">GitHub Sponsors</a>.
                    </p>
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-body text-white bg-success text-center">
                                            <a href="/blog/2020/12/21/5-new-combos-opened-by-symfony-52-and-php-80" class="d-block">
                            <div>
                                Read next → <strong>5 New Combos opened by Symfony 5.2 and PHP 8.0</strong>
                            </div>
                        </a>
                                    </div>
            </div>

            <br>
            <br>

            <a name="comments"></a>
            <div id="disqus_thread"></div>

<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
    /*
    var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = 'https://itsworthsharing.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
        </div>

        <script id="dsq-count-scr" src="https://itsworthsharing.disqus.com/count.js" async defer></script>

        <link href="/assets/prism/prism.css" rel="stylesheet" type="text/css" />
        <script src="/assets/prism/prism.js"></script>

        <script>
    ga=function(){ ga.q.push(arguments) };
    ga.q=[];
    ga.l=+new Date;
    ga('create', 'UA-46082345-1', 'auto');
    ga('send','pageview');
</script>
<script src="https://www.google-analytics.com/analytics.js" async defer></script>

        <script type="text/javascript">
            // @see https://stackoverflow.com/a/30776817/1348344
            var date = new Date();
            // display every 2nd hour, not to spam users
            if (date.getHours() % 2 === 1) {
                document.querySelector('.book-banner').style.display = 'visible';
            } else {
                document.querySelector('.book-banner').style.display = 'none';
            }
        </script>
    </body>
</html>
