<!DOCTYPE html>
<html lang="en">
    <head>
        <title>How Static Methods Kill You Like Corona | Tomas Votruba</title>
<meta charset="utf-8">
<meta name="robots" content="index, follow">

<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">

<meta name="twitter:card" content="summary"/>
<meta name="twitter:creator" content="@votrubaT"/>

<meta property="og:image" content="/assets/images/tomas_votruba.jpg"/>

<link rel="alternate" type="application/rss+xml" title="Tomas Votruba Blog RSS" href="/rss.xml">


<link rel="stylesheet" rel="preload" as="style" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:700&amp;display=swap" />

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous" media="print" onload="this.media='all'">

<link href="/assets/css/style.css?961345664" rel="stylesheet" type="text/css" />

                <meta property="og:title" content="How Static Methods Kill You Like Corona" />
        <meta property="og:url" content="https://tomasvotruba.com/blog/2020/08/31/how-static-methods-kills-you-like-corona" />
        <meta name="description" property="og:description" content="Do you know [the Broken Window theory](https://blog.codinghorror.com/the-broken-window-theory/)? It&#039;s a social pattern in code, a great post written by a guy behind one small manual website - StackOverflow.

If you combine this theory and Static Methods in Your code, you&#039;ll get Corona. As we already know, it might or might not be deadly. How it spreads, what are ways to protect, can we cure it?
" />

                    <meta property="og:image" content="https://tomasvotruba.com/assets/images/posts/static_corona_grand_parents.jpg" />
            <meta name="twitter:card" content="summary_large_image"/>
            </head>

    <body>
        <!-- post_id: 276 -->
        <div id="menu">
    <div class="container-fluid">
        <a href="/">Home</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/blog">Blog</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/book/the-power-of-automated-refactoring">Book</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/trainings">Trainings</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/contact">Contact</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/about-me">About Me</a>
        <span class="pl-2 pr-2">•</span>

        <a href="https://twitter.com/votrubaT" target="blank">Twitter</a>
        <span class="pl-2 pr-2">•</span>

        <a href="/rss.xml" target="blank">RSS</a>
    </div>
</div>

        <div class="container-fluid post" id="content">
            <div class="text-center book-banner">
                <a href="https://leanpub.com/rector-the-power-of-automated-refactoring" target="blank" class="text-center">
                    <img src="/assets/images/banner-rector-book.png" class="mb-2 ml-auto mr-auto rounded " style="max-height: 5em" alt="">
                </a>
            </div>

            <h1>How Static&nbsp;Methods Kill&nbsp;You Like&nbsp;Corona</h1>

            <div class="pull-right">
                <a href="https://github.com/tomasvotruba/tomasvotruba.com/edit/main/packages/blog/data/2020/2020-08-31-how-static-methods-kills-you-like-corona.md">Found a typo? Edit me</a>
            </div>

            <time datetime="2020-08-Mon" class="text-muted">
                2020-08-31
            </time>

            
            
            <div class="card card-bigger mb-5">
                <div class="card-body pb-2">
                    <p>Do you know <a href="https://blog.codinghorror.com/the-broken-window-theory/">the Broken Window theory</a>? It's a social pattern in code, a great post written by a guy behind one small manual website - StackOverflow.
<br><br>
If you combine this theory and Static Methods in Your code, you'll get Corona. As we already know, it might or might not be deadly. How it spreads, what are ways to protect, can we cure it?</p>
                </div>
            </div>

            <h2 id="Single-Child-in-Classroom-Problem">Single Child in Classroom Problem</h2>
<p>It's September here, and many of friends walked their children to the school. Some for the first time in their life. Everyone is very cautious because it takes precisely <strong>1 corona-infected</strong> child, parent, or teacher to spread to another person very effectively.</p>
<img src="/assets/images/posts/static_corona_child.jpg" class="img-thumbnail">
<p>Some of my friends are teachers, and their prognosis is that most schools get closed down till the end of September. Why? Because if you have 1 infected child in a classroom of 30 children, all their teachers and schoolmates can be infected too. The problem is, tests take too long. <strong>It's not instant feedback</strong>. So we have to wait, hope, make up rationalizations in the meantime.</p>
<p>Playing statistics with fear now, but I think you've already got used to it from the news for the last 9 months.</p>
<h2 id="Elderly-and-Weak-People-are-the-Corona-Goal">Elderly and Weak People are the Corona Goal</h2>
<p>&quot;Ok, so few schools get closed down, what's a big of a deal?&quot; you might think. And you might be right. There is not much health risk in not going to a place. Have you heard of a person that died from not going to the cinema?</p>
<p>The problem is when the corona spreads to fragile people - the elderly and those with other illnesses. What happens when a lot of young and strong people get infected? Let's say they have a temperature, but no-one dies. As everything is connected in today's world, this <strong>speeds up corona spread</strong> between <em>strong population</em> and <em>weak population</em> and puts enormous danger on the latter.</p>
<p>So much for corona.</p>
<h2 id="Corona-Infected-Child-in-a-Classroom-is-like-a-Static-Method">Corona Infected Child in a Classroom is like a Static Method</h2>
<p>If we only were as conscious and reacted fast with static methods as we react with a single corona infected person. <strong>But don't care, because it's <a href="/blog/2020/01/13/why-is-first-instant-feedback-crucial-to-developers/">not instant feedback</a></strong>.</p>
<ul>
<li>
<p>Imagine <em>static methods</em> is like a strong population infected by corona. They can go anywhere; they don't care; they will live.</p>
</li>
<li>
<p>Imagine <em>service methods</em> (non-static) are like a weak population; they were not infected yet. They're ok, for now.</p>
</li>
</ul>
<h2 id="and-quot-Show-me-Some-Code-and-quot">&quot;Show me Some Code!&quot;</h2>
<p>Do you want real meat? Let's look at code that can put down the company for many months:</p>
<h3 id="Strong-Population">Strong Population</h3>
<pre><code class="language-php">final class InfectedYoungChild
{
    public static function spreadInfection()
    {
        // ...
    }
}</code></pre>
<pre><code class="language-php">final class InfectedYoungParent
{
    public static function spreadInfection()
    {
        // ...
    }
}</code></pre>
<pre><code class="language-php">final class ClassRoom
{
    public static function spreadInfection()
    {
        InfectedYoungChild::spreadInfection();
        // ...
        InfectedYoungParent::spreadInfection();
        // ...
    }
}</code></pre>
<p>Imagine 100 more static methods in your code, so we save some paper.
To give your real-life example, one of the projects we migrate now has over 350 static methods in 110 000 lines of code.</p>
<h3 id="Weak-Population">Weak Population</h3>
<p>Let's say grandma feels lonely and <strong>wants to see their grandchildren</strong>, that gives her joy and purpose to live.</p>
<img src="/assets/images/posts/static_corona_grand_parents.jpg" class="img-thumbnail">
<p>At least once in a <em>while</em> (pun intended!):</p>
<pre><code class="language-php">final class HealthyGrandma
{
    public function seeGrandChildren(array $youngChildren)
    {
        foreach ($youngChildren as $youngChild) {
            if ($youngChild instanceof HuggableInterface) {
                $youngChild-&gt;hug($this);
            }
        }
    }
}</code></pre>
<p>But she's afraid, so she wants to be sure her grandchild won't kill her.</p>
<pre><code class="language-php">final class HealthyGrandma
{
    public function seeGrandChildren(array $youngChildren)
    {
        foreach ($youngChildren as $youngChild) {
            if ($youngChild instanceof InfectableInterface) {
                if ($youngChild-&gt;isInfected()) {
                    // the child is infected, can't happen, sorry :(
                    continue;
                }
            }

            if ($youngChild instanceof HuggableInterface) {
                $youngChild-&gt;hug($this);
            }
        }
    }
}</code></pre>
<h2 id="The-Italy-Mayhem-Problem">The Italy Mayhem Problem</h2>
<p>How can we detect <code>InfectableInterface</code> in a static class? How can we collect data about infections in static classes?</p>
<p>We can't. And that's what happened in Italy this spring. Little control over the strong and weak part of your code population.</p>
<p>What can we do about it? I know you won't like it, <a href="/blog/2019/04/01/removing-static-there-and-back-again/">it's a lot of work</a> that has no impact right now - refactor static to non-static:</p>
<pre><code class="language-diff">-final class InfectedYoungChild
+final class InfectedYoungChild implements InfectableInterface
 {
-    public static function spreadInfection()
+    public function spreadInfection()
     {
         // ...
     }
 }</code></pre>
<p>And also...</p>
<pre><code class="language-diff">-final class InfectedYoungParent
+final class InfectedYoungParent implements InfectableInterface
{
-    public static function spreadInfection()
+    public function spreadInfection()
     {
         // ...
     }
 }</code></pre>
<p><strong>And mostly, all their dependencies... and their dependencies...</strong></p>
<pre><code class="language-diff">-final class ClassRoom
+final class ClassRoom implements InfectableInterface
 {
+    private InfectedYoungChild $infectedYoungChild;
+
+    InfectedYoungParent $infectedYoungParent
+
+    public fuction __construct(
+        InfectedYoungChild $infectedYoungChild,
+        InfectedYoungParent $infectedYoungParent
+    ) {
+         $this-&gt;infectedYoungChild = $infectedYoungChild;
+         $this-&gt;infectedYoungParent = $infectedYoungParent;
+    }

-    public static function spreadInfection()
+    public function spreadInfection()
     {
-        InfectedYoungChild::spreadInfection();
+        $this-&gt;infectedYoungChild-&gt;spreadInfection();
         // ...
-        InfectedYoungParent::spreadInfection();
+        $this-&gt;infectedYoungParent-&gt;spreadInfection();
         // ...
     }
 }</code></pre>
<p>This is the only way to save <a href="/blog/2018/04/26/how-i-got-into-static-trap-and-made-fool-of-myself/">from fractal static spread</a>.</p>
<p><br>
<br></p>
<p><strong>It might take time, work, effort, sweat &amp; tears, but it's worth it for the future.</strong></p>
<p><br></p>
<img src="/assets/images/posts/static_corona_safe.jpg" class="img-thumbnail">
<p><br></p>
<blockquote class="blockquote text-center">
<p>Great programmers do not live for today's delivered features,<br>
they live for <a href="/blog/2018/04/30/programming-climbing-a-huge-mountain/">the top of the mountain</a> in years of work.</p>
</blockquote>
<p><br></p>
<h2 id="What-if-We-Find-the-Corona-Cure">What if We Find the Corona Cure?</h2>
<pre><code class="language-php">$coronaCure = new CoronaCure();

$infectables = $container-&gt;getByType(InfectableInteface::class);

foreach ($infectables as $infectable) {
    if (! $infectable-&gt;isInfected()) {
        continue;
    }

    $coronaCure-&gt;cure($infectable);
}</code></pre>
<p>Be sure to have all your services in your container, so they're available <strong>when you need them</strong>.</p>
<p><br></p>
<p>Happy coding!</p>

            <br>


            <div class="card mt-5 border-warning">
                <div class="card-body text-center mt-2">
                    <p>
                        Have you find this post useful? <strong>Do you want more?</strong>
                    </p>
                    <p>
                        Follow me on <a href="https://twitter.com/votrubaT">Twitter</a>, <a href="/rss.xml">RSS</a> or support me on <a href="https://github.com/sponsors/TomasVotruba">GitHub Sponsors</a>.
                    </p>
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-body text-white bg-success text-center">
                                            <a href="/blog/2020/08/24/what-if-we-remove-strings-from-symfony-extension-configuratoin" class="d-block">
                            <div>
                                Read next → <strong>What if We Remove Strings from Symfony Extension Configuration</strong>
                            </div>
                        </a>
                                    </div>
            </div>

            <br>
            <br>

            <a name="comments"></a>
            <div id="disqus_thread"></div>

<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
    /*
    var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = 'https://itsworthsharing.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
        </div>

        <script id="dsq-count-scr" src="https://itsworthsharing.disqus.com/count.js" async defer></script>

        <link href="/assets/prism/prism.css" rel="stylesheet" type="text/css" />
        <script src="/assets/prism/prism.js"></script>

        <script>
    ga=function(){ ga.q.push(arguments) };
    ga.q=[];
    ga.l=+new Date;
    ga('create', 'UA-46082345-1', 'auto');
    ga('send','pageview');
</script>
<script src="https://www.google-analytics.com/analytics.js" async defer></script>

        <script type="text/javascript">
            // @see https://stackoverflow.com/a/30776817/1348344
            var date = new Date();
            // display every 2nd hour, not to spam users
            if (date.getHours() % 2 === 1) {
                document.querySelector('.book-banner').style.display = 'visible';
            } else {
                document.querySelector('.book-banner').style.display = 'none';
            }
        </script>
    </body>
</html>
